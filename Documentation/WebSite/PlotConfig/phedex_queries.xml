<phedex>

  <import file="$CONFIG_ROOT/generic_queries.xml" />

  <class type="SqlQueries" name="PhedexQueries">

    <attribute name="connection_manager"> PhedexConnMan </attribute>

    <attribute name="display_name"> Phedex Queries  </attribute>

    <query name="quantity_rates" base="GenericQuery.link_query">
      <sql>
        <filler name="column"> nvl(sum(h.done_bytes),0)/1048576/:span </filler>
      </sql>
      <attribute name="title"> CMS PhEDEx - Transfer Rate </attribute>
      <attribute name="column_names"> Transfer Rate </attribute>
      <attribute name="column_units"> MB/s </attribute>
    </query>

    <query name="quantity" base="GenericQuery.link_query">
      <sql>
        <filler name="column"> nvl(sum(h.done_bytes),0)/1099511627776 </filler>
      </sql>
      <attribute name="title"> CMS PhEDEx - Transfer Volume</attribute>
      <attribute name="column_names"> Data Transferred </attribute>
      <attribute name="column_units"> TB </attribute>
    </query>

    <query name="quantity_cumulative" base="GenericQuery.link_query">
      <sql>
        <filler name="column"> nvl(sum(h.done_bytes),0)/1099511627776 </filler>
      </sql>
      <results module="phedex.database.query_handler" function="cumulative_pivot_group_parser" />
      <attribute name="title"> CMS PhEDEx - Cumulative Transfer Volume </attribute>
      <attribute name="column_names"> Data Transferred </attribute>
      <attribute name="column_units"> TB </attribute>
      <attribute name="graph_type"> PhedexCumulative </attribute>
    </query>

    <query name="destined" base="GenericQuery.dest_query">
      <sql>
        <filler name="column"> nvl(sum(dest_bytes) keep (dense_rank last order by timebin asc),0)/1099511627776 </filler>
      </sql>
      <attribute name="title"> CMS PhEDEx - Volume of Routed Data  </attribute>
      <attribute name="column_names"> Data Routed  </attribute>
      <attribute name="column_units"> TB </attribute>
    </query>

    <query name="resident" base="GenericQuery.dest_query">
      <sql>
        <filler name="column"> nvl(sum(node_bytes) keep (dense_rank last order by timebin asc),0)/1099511627776 </filler>
      </sql>
      <attribute name="title"> CMS PhEDEx - Volume of Resident Data </attribute>
      <attribute name="column_names"> Data Resident </attribute>
      <attribute name="column_units"> TB </attribute>
    </query>

    <query name="pending" base="GenericQuery.link_stats_query">
      <sql>
        <filler name="column"> nvl(sum(h.pend_bytes) keep (dense_rank last order by timebin asc),0)/1099511627776 </filler>
      </sql>
      <attribute name="title"> CMS PhEDEx - Volume of Queued Data </attribute>
      <attribute name="column_names"> Queued Data </attribute>
      <attribute name="column_units"> TB </attribute>
    </query>

    <query name="request" base="GenericQuery.dest_query">
      <sql>
        <filler name="column"> nvl(sum(request_bytes) keep (dense_rank last order by timebin asc),0)/1099511627776 </filler>
      </sql>
      <attribute name="title"> CMS PhEDEx - Volume of Requested Data </attribute>
      <attribute name="column_names"> Data Requested </attribute>
      <attribute name="column_units"> TB </attribute>
    </query>

    <query name="idle" base="GenericQuery.dest_query">
      <sql>
        <filler name="column"> nvl(sum(idle_bytes) keep (dense_rank last order by timebin asc),0)/1099511627776 </filler>
      </sql>
      <attribute name="title"> CMS PhEDEx - Volume of Idle Data </attribute>
      <attribute name="column_names"> Idle Data </attribute>
      <attribute name="column_units"> TB </attribute>
    </query>

    <query name="cooloff" base="GenericQuery.link_stats_query">
      <sql>
        <filler name="column"> nvl(sum(cool_bytes) keep (dense_rank last order by timebin asc),0)/1099511627776 </filler>
      </sql>
      <attribute name="title"> CMS PhEDEx - Volume of Data in Cool-off </attribute>
      <attribute name="column_names"> Data in Cool-off </attribute>
      <attribute name="column_units"> TB </attribute>
    </query>

    <query name="quality_all" base="GenericQuery.link_query">
      <sql>
        <filler name="column"> nvl(sum(h.try_files),0), nvl(sum(h.done_files),0), nvl(sum(h.fail_files),0) </filler>
      </sql>
      <results>
        <inputs> <input name="results"> 3,4,5 </input> </inputs>
      </results>
      <attribute name="graph_type"> PhedexQualityMap </attribute>
      <attribute name="title"> CMS PhEDEx - Transfer Quality </attribute>
      <attribute name="column_names"> Attempted Transfers, Successful Transfers, Failed Transfers </attribute>
      <attribute name="column_units"> Files, Files, Files </attribute>
    </query>

    <query name="quality_try" base="GenericQuery.link_query">
      <sql>
        <filler name="column"> nvl(sum(h.try_files),0) </filler>
      </sql>
      <attribute name="title"> CMS PhEDEx - Number of Attempted Transfers </attribute>
      <attribute name="column_names"> Attempted Transfers </attribute>
      <attribute name="column_units"> Files </attribute>
    </query>

    <query name="quality_done" base="GenericQuery.link_query">
      <sql>
        <filler name="column"> nvl(sum(h.done_files),0) </filler>
      </sql>
      <attribute name="title"> CMS PhEDEx - Number of Successful Transfers </attribute>
      <attribute name="column_names"> Successful Transfers </attribute>
      <attribute name="column_units"> Files </attribute>
    </query>

    <query name="quality_fail" base="GenericQuery.link_query">
      <sql>
        <filler name="column"> nvl(sum(h.fail_files),0) </filler>
      </sql>
      <attribute name="title"> CMS PhEDEx - Number of Failed Transfers </attribute>
      <attribute name="column_names"> Failed Transfers </attribute>
      <attribute name="column_units"> Files </attribute>
    </query>

  </class>

</phedex>
