<phedex>

  <import file="$GRAPH_CONFIG_ROOT/generic_queries.xml" />

  <class type="SqlQueries" name="PhedexQueries">

    <attribute name="connection_manager"> PhedexConnMan </attribute>

    <attribute name="display_name"> Phedex Queries  </attribute>

    <query name="quantity" base="GenericQuery.link_query">
      <sql>
        <filler name="column"> nvl(sum(h.done_bytes),0)/1099511627776 </filler>
      </sql>
      <attribute name="column_names"> Data Transferred </attribute>
      <attribute name="column_units"> TB </attribute>
      <attribute name="title"> PhEDEx Data Transfers </attribute>
    </query>

    <query name="quantity_cumulative" base="GenericQuery.link_query">
      <sql>
        <filler name="column"> nvl(sum(h.done_bytes),0)/1099511627776 </filler>
      </sql>
      <results module="phedex.database.query_handler" function="cumulative_pivot_group_parser" />
      <attribute name="column_names"> Data Transferred </attribute>
      <attribute name="column_units"> TB </attribute>
      <attribute name="title"> PhEDEx Data Transfers Cumulative </attribute>
      <attribute name="graph_type"> phedex_link_cumulative_generic </attribute>
    </query>

    <query name="quantity_cumulative2" base="GenericQuery.link_query">
      <sql>
        <filler name="column"> nvl(sum(h.done_bytes),0)/1099511627776 </filler>
      </sql>
      <results module="phedex.database.query_handler" function="cumulative_pivot_group_parser"/>
      <attribute name="column_names"> Data Transferred </attribute>
      <attribute name="column_units"> TB </attribute>
      <attribute name="title"> PhEDEx Data Transfers Cumulative </attribute>
      <attribute name="graph_type"> phedex_link_cumulative_generic </attribute>
    </query>

    <query name="cooloff" base="GenericQuery.link_stats_query">
      <sql>
        <filler name="column"> nvl(sum(cool_bytes) keep (dense_rank last order by timebin asc),0)/1099511627776 </filler>
      </sql>
      <attribute name="column_units"> TB </attribute>
      <attribute name="column_names"> Cooloff </attribute>
      <attribute name="title"> Data in Cooloff </attribute>
    </query>

    <query name="idle" base="GenericQuery.dest_query">
      <sql>
        <filler name="column"> nvl(sum(idle_bytes) keep (dense_rank last order by timebin asc),0)/1099511627776 </filler>
      </sql>
      <attribute name="column_units"> TB </attribute>
      <attribute name="column_names"> Idle Data </attribute>
      <attribute name="title"> Amount of Idle Data (routed, but not actively transferring) </attribute>
    </query>

    <query name="quantity_rates" base="GenericQuery.link_query">
      <sql>
        <filler name="column"> nvl(sum(h.done_bytes),0)/1048576/:span </filler>
      </sql>
      <attribute name="column_units"> MB/s </attribute>
      <attribute name="column_names"> Transfer Rate </attribute>
      <attribute name="title"> Data Transfer Rates </attribute>
    </query>

    <query name="pending" base="GenericQuery.link_stats_query">
      <sql>
        <filler name="column"> nvl(sum(h.pend_bytes),0)/1099511627776 </filler>
      </sql>
      <attribute name="column_units"> TB </attribute>
      <attribute name="column_names"> Pending Data </attribute>
      <attribute name="title"> Amount of Data Pending </attribute>
    </query>

    <query name="quality_try" base="GenericQuery.link_query">
      <sql>
        <filler name="column"> nvl(sum(h.try_files),0) </filler>
      </sql>
      <attribute name="column_units"> Files </attribute>
      <attribute name="column_names"> Attempted Transfers </attribute>
      <attribute name="title"> Number of Attempted Transfers </attribute>
    </query>

    <query name="quality_fail" base="GenericQuery.link_query">
      <sql>
        <filler name="column"> nvl(sum(h.fail_files),0) </filler>
      </sql>
      <attribute name="column_units"> Files </attribute>
      <attribute name="column_names"> Failed Transfers </attribute>
      <attribute name="title"> Number of Failed Transfers </attribute>
    </query>

    <query name="quality_done" base="GenericQuery.link_query">
      <sql>
        <filler name="column"> nvl(sum(h.done_files),0) </filler>
      </sql>
      <attribute name="column_units"> Files </attribute>
      <attribute name="column_names"> Finished Transfers </attribute>
      <attribute name="title"> Number of Finished Transfers </attribute>
    </query>

    <query name="quality_all" base="GenericQuery.link_query">
      <sql>
        <filler name="column"> nvl(sum(h.try_files),0), nvl(sum(h.done_files),0), nvl(sum(h.fail_files),0) </filler>
      </sql>
      <results>
        <inputs> <input name="results"> 3,4,5 </input> </inputs>
      </results>
      <attribute name="graph_type"> phedex_quality_map </attribute>
      <attribute name="column_units"> Files, Files, Files </attribute>
      <attribute name="column_names"> Attempted Transfers, Finished Transfers, Failed Transfers </attribute>
      <attribute name="title"> Quality Information </attribute>
    </query>
  
    <query name="destined" base="GenericQuery.dest_query">
      <sql>
        <filler name="column"> nvl(sum(dest_bytes) keep (dense_rank last order by timebin asc),0)/1099511627776 </filler>
      </sql>
      <attribute name="column_units"> TB </attribute>
      <attribute name="column_names"> Data Destined </attribute>
      <attribute name="title"> Amount of Data Destined </attribute>
    </query>

    <query name="resident" base="GenericQuery.dest_query">
      <sql>
        <filler name="column"> nvl(sum(node_bytes) keep (dense_rank last order by timebin asc),0)/1099511627776 </filler>
      </sql>
      <attribute name="column_units"> TB </attribute>
      <attribute name="column_names"> Data Resident </attribute>
      <attribute name="title"> Amount of Data Resident </attribute>
    </query>

    <query name="request" base="GenericQuery.dest_query">
      <sql>
        <filler name="column"> nvl(sum(request_bytes) keep (dense_rank last order by timebin asc),0)/1099511627776 </filler>
      </sql>
      <attribute name="column_units"> TB </attribute>
      <attribute name="column_names"> Data Requested </attribute>
      <attribute name="title"> Amount of Data Requested </attribute>
    </query>

  </class>

</phedex>
