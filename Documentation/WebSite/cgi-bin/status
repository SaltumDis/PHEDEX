#!/usr/bin/env perl

BEGIN { use strict; use warnings; $^W=1; }
use CGI qw(:standard);
use CGI::Carp qw(fatalsToBrowser);
use POSIX;
use DBI;

# Read database access tokens
my $home = $0; $home =~ s|/[^/]*$||; $home = "." if ! $home;
my @dbnames = ();
my %databases = ();
open (DBNAMES, "< $home/.db/names") || die "Failed to read database configuration\n";
while (<DBNAMES>)
{
    chomp;
    my ($db, @args) = split(/\s+/);
    $databases{$db} = [ @args ];
    push (@dbnames, $db);
}
close (DBNAMES);
my $cgi = new CGI;
my $db = $cgi->param("db") || "prod";    # tnsname of the database
my $dbversion = $databases{$db}[4] || 'V2.2';
my $dbid = $databases{$db}[3] || '';
my $dbh;

$cgi->param('db', 'prod') if ! $cgi->param('db');

print $cgi->header;
print <<EOF;
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta name="keywords" content="PhEDEx, service, status, file transfer" />
  <link rel="stylesheet" href="../status.css" type="text/css" />
  <link rel="shortcut icon" href="../favicon.ico" />
  <title>PhEDEx Service Status</title>
</head>
<body>
<p>Coming soon!</p>
</body>
</html>
EOF
exit (0);

    $ENV{TNS_ADMIN} = "/afs/cern.ch/project/oracle/admin";
    $ENV{ORACLE_HOME} = "/afs/cern.ch/project/oracle/\@sys/10103";
    $ENV{LD_LIBRARY_PATH} = "/afs/cern.ch/project/oracle/\@sys/10103/lib";
    $db = "prod" if ! grep ($db eq $_, keys %databases);
    my ($dbname, $dbuser, $dbpass, @dbjunk) = @{$databases{$db}};
    $dbh = DBI->connect ("DBI:Oracle:$dbname", $dbuser, $dbpass,
	    		 { RaiseError=>1, AutoCommit =>1 });

    $dbh->disconnect();
