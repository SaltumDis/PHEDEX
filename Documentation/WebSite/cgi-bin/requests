#!/usr/bin/env perl

BEGIN { use strict; use warnings; $^W=1; }
use CGI qw(param);
require "${0}23";
#require "${0}22";

# Read database access tokens
my @dbnames = ();
my %databases = ();
open (DBNAMES, "< /afs/cern.ch/cms/aprom/phedex/DBAccessInfo/names")
    || die "Failed to read database configuration\n";
while (<DBNAMES>)
{
    chomp;
    my ($db, @args) = split(/\s+/);
    $databases{$db} = [ @args ];
    push (@dbnames, $db);
}
close (DBNAMES);
my $db = param("db") || "prod";    # tnsname of the database
$db = "prod" if ! grep ($db eq $_, @dbnames);

param('db', 'prod') if ! param('db');
param('page', 'main') if ! param('page');

if ($databases{$db}[4] eq 'V2.3') {
  requests23::runme(\%databases, $db, @dbnames);
} else {
  # requests22::runme(\%databases, $db, @dbnames);
}
exit(0);
