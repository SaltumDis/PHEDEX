#!/usr/bin/env perl

use strict;
use warnings;
use CGI qw(:standard);
use CGI::Carp qw(fatalsToBrowser);
use POSIX;

my $cgi = new CGI;

# ###############################################
# Main loop
# ###############################################

intro();
end();

# ###############################################
# Subroutines
# ###############################################
sub intro
{
    $| = 1;

    my $stamp = strftime ("%Y-%m-%d %H:%M:%S %Z", localtime(time()));
    print $cgi->header();

    print $cgi->start_form(-method=>'POST');

    # What we need to do here is work out what was selected, and
    # set those again. Lassi does this by getting the query string
    # and remapping it... we can do it by parsing the command line
    # and rebuilding the menu &c list so that the correct things are
    # selected when you re-enter

    print "
        <head>
        <title>PhEDEx monitoring</title>
        <meta http-equiv=\"refresh\" content=\"5\">
        </head>
        <body>
        <h1>PhEDEx Monitoring</h1>
        <p>$stamp
    ";
    
    my %pages = (   'main','Front page',
                    'transfer','Transfer state');
    print "<select name='page'>";
    foreach my $page ( keys %pages ) {
        my $sel = "";
        if ( "$cgi->param('page')" eq "$page" ) { $sel = "selected"; }
        print "<option $sel value='$page'>$pages{$page}</option>";
    }
    print "</select>";

    print "<input type='submit' value='submit'>";
    
    if ($cgi->param('page')) { print $cgi->param('page'); }
}

sub end
{
    print "</body></html>";
}