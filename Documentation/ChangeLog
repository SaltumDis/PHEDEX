* Changes in PhEDEx 2.5.0

The changes for this release are too numerous to list them in great
detail. Hence, what follows is a brief overview of the main features
and improvements.

 General changes:

   - Transfer workflow optimized, so that sites need to run less agents.
     Most sites will only need three agents:
     FileDownload, FileRemove and FileExport.
   - Individual agents can run and complete tasks for multiple sites.
   - New agent work scheduling leading to:
        - Reduced DB load.
	- Reduced amount of parallel DB connections.
	- Agent shutdown doesn't interrupt running transfers and allows
	  draining of task queue.
   - Improved fair share taking into account link performance and
     preventing starving of slower links.
   - Logs of failed transfers accessible via web page.
   - Transfer prioritization.
   - Only one cool-off with reduced cycle time. No resetting needed
     anymore.
   - PhEDEx now keeps record of the SE names for each node.
   - BlockDLSUpdate can run centrally for multiple sites.
   - Subscriptions now possible for full datasets and individual blocks.
   - Improved robustness of agent communication with TMDB preventing
     agents from blocking each other.
   - PhEDEx now benefits from running on a DB cluster.
   - Tools for automatic synchronization with DBS.
	
 Web site changes:

   - Subscription allocation, modification and deletion via web page
     for site administrators authenticated by grid certificates.
   - Improved status and summary web pages, including better plotting.
   - New sites can now sign up via the web site.
   - Various improvements concerning the layout of the web interface
     (e.g positioning of scroll-bars, etc).
	
 Schema changes:

   - General performance improvements by adding indexes and partitioning
     tables.
   - Improved data consistency by adding constraints to most of the columns.
   - t_xfer_* tables changed to reflect new transfer status tracking by
     avoiding updating of tables in order to prevent DB locks.
   - Re-organized status tables t_history_* and t_status_* and put
     them in a separate module.
   - Improved performance of OracleStatsUpdate.
   - Rename administrative tables t_node and t_link* to t_adm_*.
	
	
* Changes in PhEDEx 2.4.2

 General changes:
   - Corrected FileDeleteTMDB deletion of local files.
   - DropLoadBalance updated; the agent did not work at all.

 Web site changes:
  - Corrected "interesting rows" selection on replica pages.
  - Subscription page now points to replica page.

 Schema changes:
  - TNS service names updated to allow use of streaming extensions
    required by database applications other than PhEDEx.  PhEDEx
    service definitions enable TCP keep-alive option for improved
    detection of lost database connections.


* Changes in PhEDEx 2.4.1

 General changes:
  - BlockDLSUpdate now accepts an ASCII txt list as option to '-se',
    containing pairs of nodes and storage elements. The old form of
    one '-node' and one '-se' ist still supported.
  - FileDeleteTMDB is now allowing sites to delete replicas from their
    site. Detailed instructions can be found in README-DeleteReplica.txt.
  - FileRouter now supresses multihop transfers.
	
 Web site changes:
  - Website was rewritten.
  - Extended documentation on how to setup the PhEDEx web service can be
    found in Documentation/Webconfig.

 Schema changes: none.


* Changes in PhEDEx 2.4.0

 General changes:
  - New BlockDLSUpdate agent to add fully transferred blocks to DLS.
    Please see README-Deployment.txt for configuration details.
  - FileCastorStager.New allows an option to throttle back stage-in to
    avoid Castor overload.  Use option "-protect" with an external
    script to detect overload.
  - FileDeleteTMDB updated to work also by blocks, to accept wildcards
    for node names, to remove files from the storage and to show more
    progress feedback.  The script now acquires required locks to
    protect data integrity.
  - Default site configuration templates (Custom/Template) updated.
  - Minor bug fixes to the SRM stager agent, daily report generation
    and block monitoring and deactivation agents.
  - T0FeedTest testbed to generate and feed large file samples.

 Web site changes: none.

 Schema changes:
  - tnsnames.ora updated to include other CMS databases.


* Changes in PhEDEx 2.3.12

 General changes:
  - DropTDMBPublisher -node option is now optional.  If the agent is
    started without the option and default node to inject files to,
    the drops will be required to have a non-empty PhEDEx-Nodes.txt.
    This prevents production system malfunction from registering
    files for a wrong node in TMDB by accident.
  - FileRouter now routes for nodes running just export agents but no
    download agents.  This allows site to participate as a source.
  - New FileDeleteTMDB for removing replicas and files from TMDB.
    Includes many features from Brian Bockelman's retransfer tools.

 Web site changes:
  - PHP scripts now hard code TTF font file path to avoid issues when
    the AFS web site is automatically recreated from CVS.

* Changes in PhEDEx 2.3.11

 General changes:
  - Added documentation to run in the LCG VOBOX environment.
  - Obsolete DropMTCCPublisher updated from last used version.
  - DropTMDBPublisher now takes "Options.txt" in the drop, which
    can include "strict", "!strict", "verbose", "!verbose" options
    to TMDBInject.  DropTMDBPublisher now requires the file data
    file name to end in .xml (previously .xml and .txt).
  - TMDBInject now adds the DLS attribute for a DBS.
  - FileRouter routing threshold increased from 1 TB to 5 TB.
    The transfer expire time is now automatically extended by two
    hours on links performing well enough.  That is, the transfers
    expire at the set limit only if there is no recent progress.
  - Added a missing table name alias in BlockActivate.
  - NodeNew now only creates new nodes.  New NodeRemove.
  - LinkNew, LinkRemove are new tools to administer links.

 Web site changes:
  - Preliminary work on updated transfer request handling.
  - Infrastructure for future web site changes.
  - Better coexistence of multiple schema versions.
  - Cumulative transfer plots match better transfer rate page.
  - Considerably reduced memory usage in the PHP scripts.
  - Bugs fixed for TTF font handling for newer web servers.

 Schema changes:
  - t_dps_dbs table now includes DLS contact as well.
  - Preliminary work on updated transfer requests (t_req_*).
  - Preliminary work on administrative tables (t_adm_*).
  - Various typo and interference fixes in *.sql files.

* Changes in PhEDEx 2.3.10

 General changes:
  - Various bug fixes and improvements to dCache migration agent.
  - Download agent now records the error message printed into the
    logs ("alert:" line) to the transfer state table, so remote
    sites can see the details of why files are in error states.
  - File router now requires a live download agent at destination
    and a live export agent at source to consider a link usable.
  - File router now routes files by earliest estimated time of
    arrival, aka "dynamic routing".  The time estimates are based
    on recent transfer rate performance.
  - Performance monitor now guarantees "closed" link performance
    statistics: for links with previous non-null statistics, a
    row of null performance data is inserted to guarantee a drop
    to "unused" state.  Also if there are no pending traffic on
    a link, transfer rate is reset to null (as opposed to zero).

 Web site changes:
  - State detail and transfer rate page allow node selection.
  - The transfer states are now shown as names instead of numbers.
  - Plot pages show one plot at a time and plot names are better.
  - PHP scripts doing plots now consume massively less memory.
  - Transfer state detail page now offers a link to files in each
    state combination.  For files in transfer this shows the UTC
    time of the transfer start, and for files in error states, up
    to 4000 characters of the (last) full error message as printed
    to the download agent logs at the destination site.

 Schema changes:
  - t_xfer_state adds column 'last_error' for the first 4000
    characters of the last error message (if any).
  - sqlplus login script sets variable substitution character to ':'.

* Changes in PhEDEx 2.3.9

 General changes:
  - Further improvements to the site configuration template.  There
    are now better defaults and much more extensive documentation.
  - Continued bug fixes and tuning for time-out handling.  Agents
    now remember which subprocesses they have timed out to ensure
    they really have the intended grace time to exit.
  - Agents now redirect input from /dev/null instead of closing it.
  - DropTMDBPublisher updated for TMDBInject changes.
  - File router no longer accesses t_link_param as a part of the
    migration to the new link performance estimates.  Previously
    failed transfers are given slightly more time each subsequent
    time (8-12 hours instead of previous 8 hours transfer time).
  - FTS transfers no longer abort on "Hold" status.  Spurious status
    will lead to cancelling the job so we don't leave behind junk.

 Web site changes:
  - Rate monitoring page now reports estimated link rate and latency.
  - Tier-2 workshop documents added to the list of documents.
  - PHP scripts given even more memory.

 Schema changes:
  - Updated Oracle server details.
  - A trigger now removes matching file request when a new replica is
    created.  This should avoid the race condition between router and
    recycler where we deleted both the file request and file replica.
  - t_link_param recreated with values for estimated link performance.
  - t_link_histogram now records then-current link parameters.

* Changes in PhEDEx 2.3.8

 General changes:
  - Considerably improved site configuration template.
  - Database handling changes:
    - Try harder to detect dead / unusable database connections.
    - When LogSQL is "on", print null values nicely.
  - Download agent changes:
    - Post-transfer deletes on failed transfer weren't working; fixed.
    - Timed out transfers now get 30 seconds to exit per signal sent.
  - Improvements to a configuration using pure SRM interface:
    - Download verification script trusts the exit code from the copy.
      The checking of download success using SRM was too expensive.
      Now also passes certificate proxy options to the srm-* commands.
    - Deletion script only deletes after failed transfer, no longer
      before every transfer as the latter was too expensive and post
      failure handling was considered good enough.  Now also passes
      certificate proxy options to the srm-* commands.
    - Migration agent rewritten.
    - Improvements to the stage-in agent.
    - Main export agent provided.
  - TestCatalogue did not correctly verify PFN-to-LFN, corrected.

 Web site changes:
  - Status browser updated for hosted with cmsdoc + mod_perl.  The
    transfer rate table now shows only one time span at a time.  Fixed
    the quoting of magic characters (<, >, etc.) in database report.
  - Various tweaks to the plots to better lay out the legend.
  - The legend in transfer queue page is now corrected to include only
    the items actually included in the plot.
  - The PHP plotting scripts are now hosted on cmsdoc.cern.ch.
  - Instructions for hosting the web site.

 Schema changes:
  - t_authorisation.role_name and t_info_agent_status.agent extended.
  - Performance data (t_*_histogram) older than about two days is now
    automatically compacted to time seris in 1-hour bins; newer data
    remains in the current 5-minute bins.

* Changes in PhEDEx 2.3.7

 General changes:
  - Template site configuration updated.
  - Download agent now defaults to 30 concurrent jobs.
  - Better handling of subprocesses on download agent exit.
  - File router and monitoring tweaked not to slow each other down.
  - Ftscp now handles timeout cancellation (= signal handling) and
    sleeps longer time as the download takes time.  The final FTS
    transfer status is now dumped to the output, i.e. PhEDEx logs.
    Ftscp ignores up to five glite-* server side errors to avoid
    death by intermittent glite server side database connection
    pooling problems.

 Web site change:
  - Rate page now allows source and/or destination to be filtered.
  - CERN network plots removed from the rate page.
  - Minor HTML improvements here and there.
  - Plots no longer have a black frame.

 Schema changes:
  - Nodes now have a new column 'kind' for administrative purposes.

* Changes in PhEDEx 2.3.6

 General changes:
  - Various improvements to ftscp.
  - Preliminary SRM-only agents for stage-in and tape migration.
  - Job manager changes for Castor stager agent: subprocess output
    receives "log" prefixing now only if explicitly requested.
  - Derek's catalogue test tool, slightly adapted.

 Web site change:
  - PHP scripts allowed more memory so link stats can be plotted.

 Schema changes: none.

* Changes in PhEDEx 2.3.5

 General changes:
  - Correction in handling -ignore/-accept options.  If a wildcard
    was used, not all matching nodes were filtered.
  - Download agent applies the -ignore/-accept option also when
    marking files wanted.  This makes no functional difference,
    but more correct.

 Schema changes: none.

* Changes in PhEDEx 2.3.4

 General changes:
  - Download agent improvements:
    - Log files are now prefixed by agent "boot time" so logs
      from different runs of the agent remain separate.
    - Globus backend got same logging improvements as SRM previously.

  - Block management agents:
    - Suspended blocks are now reactivated correctly if the suspend
      time (time_suspend_until) is reset to null, as opposed to just
      expiring.

  - Minor improvements to the status web browser.
    - The browser plots are now by destination by default, by link
      was too much information for default overall situation.  By
      link display is still recommended when filter for a site as
      it shows in one view all incoming and outgoing transfers.
    - Plot legend font size shrinks if many sites are included.
    - Remove rare warnings in daily stats generation.

 Schema changes:
  - INT2R TNS entries adjusted.
  - Further review of indexes.
  - t_xfer_replica authorisations corrected.
  - Certain tables are now partitioned by node.  The partitions are
    automatically added and removed by triggers on insert to or
    delete from t_node.

* Changes in PhEDEx 2.3.3

 General changes:
  - Download agent improvements:
    - The agent now uses from_node to determine to_pfn so the trivial
      file catalogue can offer different destination PFNs based on
      the source site using "destination-match".  This now reflects
      export side better: both download source and destination use a
      compatible convention.
    - Error logging has changed.  The log file for a failed transfer
      is now mentioned in the file transfer failure alert, not in a
      separate message.  The -validate etc. utility commands log the
      output directly to the main agent log, not separate log files.
      The agent now removes logs older than three days when the agent
      is idle (was 15 minutes of idle time).  The log for the transfer
      command now includes the full command line and the exit code.
      The log file prefixing scheme should no longer lose newlines.
    - Subprocess queue is no longer overfilled.  This should reduce
      the number of instances of time_transfer > timeout setting; the
      still runs only for the timeout period, the rest is queue wait.
    - Stopping the agent now correctly runs transfer validation.

  - File routing improvements:
    - The agent now routes only for nodes which have recently ran a
      download agent.  This prevents creation of routes for sites
      which are down, and therefore excessive transfer expiration.
    - File routing requests are now removed if the underlying dataset
      subscription has been suspended or removed.
    - Idle transfer requests with no file request are now removed.
      This prevents unnecessary transfers when routing changes, and
      automatically removes transfers when subscription is suspended.
    - If a file has already reached the destination, then removed,
      routes are now recreated automatically.  (See schema changes.)
    - Prevent race conditions with new file injection and routing.

  - Minor improvements to the status web browser.
    - Faster loading transfer rate page.
    - Transfer rate sorts by more values for better ordering.
    - Plot of pending transfer queue is now correct.

 Schema changes:
  - Additional trigger to reinsert transfer requests for removed replicas.
  - Corrected time in trigger to insert transfer requests for new files.
  - File routing tables enforce access only at CERN.

* Changes in PhEDEx 2.3.2

 General changes:
  - Update of "ftscp".
  - Download agent errors with -ignore/-accept options fixed.
  - Master now supports "kill" option, and can "renice" agents.
  - Database deadlocks with download/export agents should now be solved.
  - Improvements and minor fixes in the file routing algorithms.
  - Many performance optimisations and streamlining in various agents.
    Anything involving node filters (-nodes, -ignore, -accept) was
    reimplemented to be more database performance friendly.
  - Minor updates to the web pages and plots.
  - Some new tests have been included.

 Schema changes:
  - Database index review.  Many indexes have been added and removed.
  - t_dps_block_dest has a new 'state' column.
  - New trigger tr_xfer_file_insert, which inserts files for active
    block destinations automatically into t_xfer_request.
  - t_info_* tables now have constraints.
