{\rtf1\mac\ansicpg10000\uc1\deff0\stshfdbch0\stshfloch0\stshfhich0\stshfbi0\deflang1033\deflangfe1033{\upr{\fonttbl{\f0\fnil\fcharset256\fprq2{\*\panose 00020206030504050203}Times New Roman;}
{\f6\fnil\fcharset256\fprq2{\*\panose 00020005000000000000}Courier;}{\f15\fnil\fcharset78\fprq2 \'82l\'82r \'96\'be\'92\'a9;}}{\*\ud{\fonttbl{\f0\fnil\fcharset256\fprq2{\*\panose 00020206030504050203}Times New Roman;}
{\f6\fnil\fcharset256\fprq2{\*\panose 00020005000000000000}Courier;}{\f15\fnil\fcharset78\fprq2 \u-211 _\u-205 _ \u26126 _\u26397 _;}}}}{\colortbl;\red0\green0\blue0;\red0\green0\blue255;\red0\green255\blue255;\red0\green255\blue0;\red255\green0\blue255;
\red255\green0\blue0;\red255\green255\blue0;\red255\green255\blue255;\red0\green0\blue128;\red0\green128\blue128;\red0\green128\blue0;\red128\green0\blue128;\red128\green0\blue0;\red128\green128\blue0;\red128\green128\blue128;\red192\green192\blue192;}
{\stylesheet{\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 \lang2057\langfe1033\cgrid\langnp2057\langfenp1033 \snext0 Normal;}{\*\cs10 \additive Default Paragraph Font;}{\*
\ts11\tsrowd\trftsWidthB3\trpaddl108\trpaddr108\trpaddfl3\trpaddft3\trpaddfb3\trpaddfr3\tscellwidthfts0\tsvertalt\tsbrdrt\tsbrdrl\tsbrdrb\tsbrdrr\tsbrdrdgl\tsbrdrdgr\tsbrdrh\tsbrdrv 
\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 \fs20\lang1024\langfe1024\cgrid\langnp1024\langfenp1024 \snext11 Normal Table;}{\s15\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 
\f6\lang2057\langfe1033\cgrid\langnp2057\langfenp1033 \sbasedon0 \snext15 \styrsid6378799 Plain Text;}}{\*\listtable{\list\listtemplateid-1201380266\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace0
\levelindent0{\leveltext\leveltemplateid-451376472\'02\'00.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1\fbias0 \fi-440\li800\jclisttab\tx800\lin800 }{\listlevel\levelnfc4\levelnfcn4\leveljc0\leveljcn0\levelfollow0
\levelstartat1\levelspace0\levelindent0{\leveltext\leveltemplateid67698713\'02\'01.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1 \fi-360\li1440\jclisttab\tx1440\lin1440 }{\listlevel\levelnfc2\levelnfcn2\leveljc2\leveljcn2
\levelfollow0\levelstartat1\levelspace0\levelindent0{\leveltext\leveltemplateid67698715\'02\'02.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1 \fi-180\li2160\jclisttab\tx2160\lin2160 }{\listlevel\levelnfc0\levelnfcn0\leveljc0
\leveljcn0\levelfollow0\levelstartat1\levelspace0\levelindent0{\leveltext\leveltemplateid67698703\'02\'03.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1 \fi-360\li2880\jclisttab\tx2880\lin2880 }{\listlevel\levelnfc4\levelnfcn4
\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace0\levelindent0{\leveltext\leveltemplateid67698713\'02\'04.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1 \fi-360\li3600\jclisttab\tx3600\lin3600 }{\listlevel\levelnfc2
\levelnfcn2\leveljc2\leveljcn2\levelfollow0\levelstartat1\levelspace0\levelindent0{\leveltext\leveltemplateid67698715\'02\'05.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1 \fi-180\li4320\jclisttab\tx4320\lin4320 }{\listlevel
\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace0\levelindent0{\leveltext\leveltemplateid67698703\'02\'06.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1 \fi-360\li5040\jclisttab\tx5040\lin5040 }
{\listlevel\levelnfc4\levelnfcn4\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace0\levelindent0{\leveltext\leveltemplateid67698713\'02\'07.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1 \fi-360\li5760
\jclisttab\tx5760\lin5760 }{\listlevel\levelnfc2\levelnfcn2\leveljc2\leveljcn2\levelfollow0\levelstartat1\levelspace0\levelindent0{\leveltext\leveltemplateid67698715\'02\'08.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1 
\fi-180\li6480\jclisttab\tx6480\lin6480 }{\listname ;}\listid1356925417}}{\*\listoverridetable{\listoverride\listid1356925417\listoverridecount0\ls1}}{\*\rsidtbl \rsid662841\rsid1523512\rsid5772644\rsid6232420\rsid6378799\rsid10055205\rsid10699851
\rsid12207247\rsid16283747}{\info{\title Node Testbed deployment and user guide}{\author Tim Barrass}{\operator Tim Barrass}{\creatim\yr2004\mo7\dy28\hr12\min36}{\revtim\yr2004\mo9\dy3\hr16\min43}{\version40}{\edmins86}{\nofpages1}{\nofwords1441}
{\nofchars8214}{\*\company University of Bristol}{\nofcharsws10087}{\vern24577}}\margl359\margr359 \ftnbj\aenddoc\noxlattoyen\expshrtn\noultrlspc\dntblnsbdb\nospaceforul\hyphcaps0\formshade\horzdoc\dgmargin\dghspace180\dgvspace180\dghorigin1701
\dgvorigin1984\dghshow0\dgvshow0\jexpand\viewkind4\viewscale100\pgbrdrhead\pgbrdrfoot\splytwnine\ftnlytwnine\htmautsp\nolnhtadjtbl\useltbaln\alntblind\lytcalctblwd\lyttblrtgr\lnbrkrule\nobrkwrptbl\rsidroot12669697 \fet0\sectd 
\linex0\headery708\footery708\colsx708\endnhere\sectdefaultcl\sectrsid6378799\sftnbj {\*\pnseclvl1\pnucrm\pnstart1\pnindent720\pnhang{\pntxta .}}{\*\pnseclvl2\pnucltr\pnstart1\pnindent720\pnhang{\pntxta .}}{\*\pnseclvl3\pndec\pnstart1\pnindent720\pnhang
{\pntxta .}}{\*\pnseclvl4\pnlcltr\pnstart1\pnindent720\pnhang{\pntxta )}}{\*\pnseclvl5\pndec\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl6\pnlcltr\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl7
\pnlcrm\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl8\pnlcltr\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl9\pnlcrm\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}\pard\plain 
\s15\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid6378799 \f6\lang2057\langfe1033\cgrid\langnp2057\langfenp1033 {\dbch\f15\insrsid6378799\charrsid6378799 \hich\af6\dbch\af15\loch\f6 
Node Testbed deployment and user guide
\par }\pard\plain \ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid6378799 \lang2057\langfe1033\cgrid\langnp2057\langfenp1033 {\dbch\f15\insrsid6378799\charrsid6378799 \hich\af0\dbch\af15\loch\f0 
========================================}{\f6\insrsid6378799 
\par }\pard\plain \s15\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid6378799 \f6\lang2057\langfe1033\cgrid\langnp2057\langfenp1033 {\dbch\f15\insrsid6378799\charrsid6378799 
\par \hich\af6\dbch\af15\loch\f6 1. Introduction
\par \hich\af6\dbch\af15\loch\f6 ---------------
\par 
\par \hich\af6\dbch\af15\loch\f6 It is possible to set up a testbed network of PhEDEx distribution nodes on a single machine. The nodes manage Storage Elements which are simpl\hich\af6\dbch\af15\loch\f6 
y local directories, copying files between them using cp. Files are registered in a testbed-global POOL XML catalogue (i.e. just an easily accessible file). Currently updates into an Oracle Transfer Management Database are used.
\par 
\par \hich\af6\dbch\af15\loch\f6 This document details the \hich\af6\dbch\af15\loch\f6 deployment and use of such a testbed system.
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 2. Deployment
\par \hich\af6\dbch\af15\loch\f6 -------------
\par 
\par \hich\af6\dbch\af15\loch\f6 This section details the process of setting up a simple testbed, with a simple source of data, a simple sink of data and the management infrastructure needed to link agents togeth\hich\af6\dbch\af15\loch\f6 er.
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 2a. Requirements
\par \hich\af6\dbch\af15\loch\f6 ----------------
\par 
\par }{\dbch\f15\insrsid10699851\charrsid6378799 \hich\af6\dbch\af15\loch\f6 To actually run the testbed:
\par 
\par }{\dbch\f15\insrsid6378799\charrsid6378799 \hich\af6\dbch\af15\loch\f6 Linux rh73 machine with gcc32
\par \hich\af6\dbch\af15\loch\f6 AFS access to CERN (for POOL File Catalogue tools)}{\dbch\f15\insrsid6232420\charrsid6378799 
\par \hich\af6\dbch\af15\loch\f6 Perl (with Perl DBI and DBD::MySQL installed)}{\dbch\f15\insrsid6378799\charrsid6378799 
\par }{\dbch\f15\insrsid10699851\charrsid6378799 
\par \hich\af6\dbch\af15\loch\f6 To host the TMDB:
\par 
\par \hich\af6\dbch\af15\loch\f6 A machine running MySQL to which you \hich\af6\dbch\af15\loch\f6 have root access}{\dbch\f15\insrsid10055205\charrsid6378799 
\par 
\par \hich\af6\dbch\af15\loch\f6 Naturally these can both be the same machine, but they don\rquote \hich\f6 t have to be\u8230\'85}{\dbch\f15\insrsid6378799\charrsid6378799 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 2a. TMDB deployment
\par \hich\af6\dbch\af15\loch\f6 -------------------
\par 
\par }{\dbch\f15\insrsid1523512\charrsid6378799 \hich\af6\dbch\af15\loch\f6 The TMDB can be deployed on a MySQL database}{\dbch\f15\insrsid6232420\charrsid6378799 \hich\af6\dbch\af15\loch\f6 . }{\dbch\f15\insrsid1523512\charrsid6378799 
\hich\af6\dbch\af15\loch\f6 The following instructions assume that MySQL has been successfully installed\hich\af6\dbch\af15\loch\f6 .
\par 
\par \hich\af6\dbch\af15\loch\f6 [n.b. if installing on mac os x make sure you chown \endash R mysql /usr/local/mysql/data to solve \ldblquote mysql ended\rdblquote  trouble when you try to run it. ]}{\dbch\f15\insrsid10699851\charrsid6378799 
\par 
\par \hich\af6\dbch\af15\loch\f6 [n.b. am behind a router. Had to export ports 3300-3310, and then look on a web-based \ldblquote what is my ip\rdblquote  page to ge\hich\af6\dbch\af15\loch\f6 t my ip address. Can then connect remotely. ]}{
\dbch\f15\insrsid1523512\charrsid6378799 
\par 
\par }\pard \s15\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid1523512 {\dbch\f15\insrsid1523512\charrsid1523512 \hich\af6\dbch\af15\loch\f6 $ mysql \endash -user root mysql
\par \hich\af6\dbch\af15\loch\f6 Welcome to the MySQL monitor.  Commands end with ; or \\g.
\par \hich\af6\dbch\af15\loch\f6 Your MySQL connection id is 9 to server version: 4.0.20-standard
\par 
\par \hich\af6\dbch\af15\loch\f6 Type 'help;' or '\\h' for help. Type '\\c' to clear the buffe\hich\af6\dbch\af15\loch\f6 r.
\par 
\par \hich\af6\dbch\af15\loch\f6 mysql> create database V2TMDB;
\par \hich\af6\dbch\af15\loch\f6 Query OK, 1 row affected (0.10 sec)
\par 
\par \hich\af6\dbch\af15\loch\f6 mysql> grant all privileges on V2TMDB.* to 'phedex'@'localhost' identified by \lquote phedex\rquote ;
\par \hich\af6\dbch\af15\loch\f6 Query OK, 0 rows affected (0.00 sec)
\par }{\dbch\f15\insrsid10699851\charrsid1523512 
\par }\pard \s15\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid10699851 {\dbch\f15\insrsid10699851\charrsid10699851 \hich\af6\dbch\af15\loch\f6 mysql> grant all privileges on V2TMDB.* to 'phedex'@'%' id
\hich\af6\dbch\af15\loch\f6 entified by 'phedex';
\par \hich\af6\dbch\af15\loch\f6 Query OK, 0 rows affected (0.00 sec)
\par }\pard \s15\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid1523512 {\dbch\f15\insrsid1523512\charrsid1523512 
\par \hich\af6\dbch\af15\loch\f6 mysql> exit
\par 
\par \hich\af6\dbch\af15\loch\f6 Now we create the db schema: the following SQL is roughly accurate, but check against the latest schema (tmdb-schema.eps in CVS- details below) if you have trouble.
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 create table t_\hich\af6\dbch\af15\loch\f6 nodes ( node_name varchar(20) primary key, host_string varchar(50), catalogue_contact varchar(255) );}{\dbch\f15\insrsid1523512 
\par }{\dbch\f15\insrsid1523512\charrsid1523512 
\par \hich\af6\dbch\af15\loch\f6 create table t_files_for_transfer ( guid char(36) primary key, source_node varchar(20) references t_nodes(node_name), allocated char(1));}{\dbch\f15\insrsid10699851\charrsid1523512 
\par 
\par }{\dbch\f15\insrsid10699851\charrsid10699851 \hich\af6\dbch\af15\loch\f6 create table t\hich\af6\dbch\af15\loch\f6 _replica_metadata ( guid char(36) references t_files_for_transfer(guid), attribute varchar(255), value varchar(255) );}{
\dbch\f15\insrsid10699851 
\par 
\par }{\dbch\f15\insrsid10699851\charrsid10699851 \hich\af6\dbch\af15\loch\f6 create table t_file_state ( guid char(36) references t_files_for_transfer(guid), is_for_node varchar(20) references t_nodes(node_name), \hich\af6\dbch\af15\loch\f6 
state char(1), is_at_node varchar(20) references t_nodes(node_name), timestamp int );}{\dbch\f15\insrsid10699851 
\par 
\par }{\dbch\f15\insrsid10699851\charrsid10699851 \hich\af6\dbch\af15\loch\f6 create table t_destinations ( guid char(36) references t_files_for_transfer(guid), destination_node varchar(20) references t_nodes(node_name) );}{\dbch\f15\insrsid10699851 
\par 
\par }{\dbch\f15\insrsid10699851\charrsid10699851 \hich\af6\dbch\af15\loch\f6 create table t_routing \hich\af6\dbch\af15\loch\f6 
( from_node varchar(20) references t_nodes(node_name), to_node varchar(20) references t_nodes(node_name), gateway varchar(20) references t_nodes(node_name), timestamp int, hops int );}{\dbch\f15\insrsid10699851 
\par 
\par }{\dbch\f15\insrsid10699851\charrsid10699851 \hich\af6\dbch\af15\loch\f6 create table t_agents ( name varchar(20) );}{\dbch\f15\insrsid10699851 
\par 
\par }{\dbch\f15\insrsid10699851\charrsid10699851 \hich\af6\dbch\af15\loch\f6 create table t_lookup ( no\hich\af6\dbch\af15\loch\f6 de varchar(20) references t_nodes(node_name), agent varchar(20) references t_agents(name), state char(1), last_contact int );

\par 
\par \hich\af6\dbch\af15\loch\f6 create table t_subscriptions ( destination varchar(20) references t_nodes(node_name), stream varchar(255) );}{\dbch\f15\insrsid10699851 
\par 
\par }{\dbch\f15\insrsid10699851\charrsid10699851 \hich\af6\dbch\af15\loch\f6 create table t_conf\hich\af6\dbch\af15\loch\f6 ig_messages ( node varchar(20) references t_nodes(node_name), message varchar(20), timestamp int, handled char(1) );}{
\dbch\f15\insrsid10699851 
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 et voila, your own personal TMDB.}{\dbch\f15\insrsid10699851\charrsid10699851 
\par }{\dbch\f15\insrsid10699851 
\par }\pard \s15\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid6378799 {\dbch\f15\insrsid10699851\charrsid10699851 
\par }{\dbch\f15\insrsid6378799\charrsid6378799 
\par \hich\af6\dbch\af15\loch\f6 2b. Downloading the testbed tools
\par \hich\af6\dbch\af15\loch\f6 ---------------------------------
\par 
\par \hich\af6\dbch\af15\loch\f6 Begin to create the testbed di\hich\af6\dbch\af15\loch\f6 rectory structure. On your chosen testbed machine}{\dbch\f15\insrsid10699851\charrsid6378799 \hich\af6\dbch\af15\loch\f6 -}{\dbch\f15\insrsid6378799\charrsid6378799 

\par }{\dbch\f15\insrsid16283747\charrsid6378799 
\par \tab \hich\af6\dbch\af15\loch\f6 setenv NODETESTBED /NodeTestbed [ or whatever your chosen location is}{\dbch\f15\insrsid6378799\charrsid6378799 
\par }{\dbch\f15\insrsid16283747\charrsid6378799 \tab \hich\af6\dbch\af15\loch\f6 mkdir $NODETESTBED}{\dbch\f15\insrsid6378799\charrsid6378799 
\par }{\dbch\f15\insrsid16283747\charrsid6378799 \tab \hich\af6\dbch\af15\loch\f6 cd $NODETESTBED}{\dbch\f15\insrsid12207247\charrsid6378799 
\par }{\dbch\f15\insrsid6378799\charrsid6378799 
\par }{\dbch\f15\insrsid10699851\charrsid6378799 \tab \hich\af6\dbch\af15\loch\f6 export CVSROOT=\\
\par }\pard \s15\ql \fi720\li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid10699851 {\dbch\f15\insrsid6378799\charrsid6378799 \hich\af6\dbch\af15\loch\f6 :pserver:anonymous@cmscvs.cern.ch:/cvs_server/repositories/TMAgents
\par }\pard \s15\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid6378799 {\dbch\f15\insrsid6378799\charrsid6378799 \tab 
\par \tab \hich\af6\dbch\af15\loch\f6 cvs lo\hich\af6\dbch\af15\loch\f6 gin
\par \tab \tab \hich\af6\dbch\af15\loch\f6 [ password is 98passwd ]
\par \tab \hich\af6\dbch\af15\loch\f6 cvs co AgentToolkitExamples
\par 
\par \tab \hich\af6\dbch\af15\loch\f6 cd }{\dbch\f15\insrsid12207247\charrsid6378799 \hich\af6\dbch\af15\loch\f6 AgentToolkitExamples/NodeTestbed}{\dbch\f15\insrsid6378799\charrsid6378799 
\par \tab }{\dbch\f15\insrsid10699851\charrsid10699851 \hich\af6\dbch\af15\loch\f6 source SetupEnvironment.csh}{\dbch\f15\insrsid6378799\charrsid10699851 
\par }{\dbch\f15\insrsid16283747\charrsid6378799 \tab \hich\af6\dbch\af15\loch\f6 setenv PATH $\{PATH\}:$\{NODETESTBED\}}{\dbch\f15\insrsid12207247\charrsid6378799 \hich\af6\dbch\af15\loch\f6 /A}{\dbch\f15\insrsid16283747\charrsid6378799 
\hich\af6\dbch\af15\loch\f6 gentToolkitExamples/NodeTestbed}{\dbch\f15\insrsid12207247\charrsid6378799 
\par }{\dbch\f15\insrsid16283747\charrsid6378799 \tab \hich\af6\dbch\af15\loch\f6 setenv PATH $\{PATH\}:$\{NODETESTBED\}/AgentToolkitExamples/Man\hich\af6\dbch\af15\loch\f6 agers}{\dbch\f15\insrsid12207247\charrsid6378799 
\par }{\dbch\f15\insrsid6378799\charrsid6378799 
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 2c. Deploying a simple (not full-functionality) source node
\par \hich\af6\dbch\af15\loch\f6 -----------------------------------------------------------
\par 
\par \hich\af6\dbch\af15\loch\f6 Now create a node. First we define the directory structure
\par 
\par }{\dbch\f15\insrsid16283747\charrsid6378799 \tab \hich\af6\dbch\af15\loch\f6 cd $NODETESTBED}{\dbch\f15\insrsid6378799\charrsid6378799 
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSource1
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSource1/scri\hich\af6\dbch\af15\loch\f6 pts
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSource1/logs
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSource1/work
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSource1/SE
\par 
\par \hich\af6\dbch\af15\loch\f6 Now register the node with the TMDB: in an SQL client
\par }{\dbch\f15\insrsid12207247\charrsid6378799 
\par \tab \hich\af6\dbch\af15\loch\f6 NodeManager.pl add-node \\\\
\par \tab \tab \hich\af6\dbch\af15\loch\f6 -name TBSource1 \\\\
\par }{\dbch\f15\insrsid16283747\charrsid6378799 \tab \tab \hich\af6\dbch\af15\loch\f6 -host $NODETESTBED}{\dbch\f15\insrsid12207247\charrsid6378799 \hich\af6\dbch\af15\loch\f6 /TestbedSource1/SE \\\\
\par }{\dbch\f15\insrsid16283747\charrsid6378799 \tab \tab \hich\af6\dbch\af15\loch\f6 -cat xmlcatalog_file:$NO\hich\af6\dbch\af15\loch\f6 DETESTBED}{\dbch\f15\insrsid12207247\charrsid6378799 \hich\af6\dbch\af15\loch\f6 /TestbedCatalogue.xml \\\\
\par \tab \tab \hich\af6\dbch\af15\loch\f6 -db }{\dbch\f15\insrsid16283747\charrsid6378799 \lquote \hich\af6\dbch\af15\loch\f6 mysql:database=V2TMDB;host=<host>\rquote }{\dbch\f15\insrsid6232420\charrsid6378799 \hich\af6\dbch\af15\loch\f6  }{
\dbch\f15\insrsid12207247\charrsid6378799 \\\\
\par \tab \tab \hich\af6\dbch\af15\loch\f6 -user }{\dbch\f15\insrsid6232420\charrsid6378799 \hich\af6\dbch\af15\loch\f6 phedex}{\dbch\f15\insrsid12207247\charrsid6378799 \hich\af6\dbch\af15\loch\f6  \\\\
\par \tab \tab \hich\af6\dbch\af15\loch\f6 -password }{\dbch\f15\insrsid6232420\charrsid6378799 \hich\af6\dbch\af15\loch\f6 phedex}{\dbch\f15\insrsid12207247\charrsid6378799 \hich\af6\dbch\af15\loch\f6  
\par 
\par }{\dbch\f15\insrsid10055205\charrsid6378799 \hich\af6\dbch\af15\loch\f6 DB contact strings are}{\dbch\f15\insrsid16283747\charrsid6378799 \hich\af6\dbch\af15\loch\f6 
 of the form mysql:database=V2TMDB;host=<host> for mysql, or Oracle:<db tns name>, or Oracle:}{\dbch\f15\insrsid16283747\charrsid16283747 \hich\af6\dbch\af15\loch\f6 (complete connection st\hich\af6\dbch\af15\loch\f6 ring}{
\dbch\f15\insrsid16283747\charrsid6378799 \hich\af6\dbch\af15\loch\f6 ) for Oracle}{\dbch\f15\insrsid10055205\charrsid6378799 \hich\af6\dbch\af15\loch\f6 .
\par 
\par \hich\af6\dbch\af15\loch\f6 \hich\f6 [ These are basically inserted into a Perl DBI connect method call- so there are other methods by which you could contact databases (e.g. Oracle\u8230\'85\loch\f6 
 ). See the Perl DBI, and DBD::MySQL and DBD::Oracle documentation for further details. ]}{\dbch\f15\insrsid6378799\charrsid6378799 
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 2d. Deploying a simple sink node
\par \hich\af6\dbch\af15\loch\f6 --------------------------------
\par 
\par \hich\af6\dbch\af15\loch\f6 Now create a simple sink node with a transfer agent. First define the directory structure
\par 
\par }{\dbch\f15\insrsid16283747\charrsid6378799 \tab \hich\af6\dbch\af15\loch\f6 cd $NODETESTBED}{\dbch\f15\insrsid6378799\charrsid6378799 
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSink1
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSink1/scripts
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSink1/logs
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir \hich\af6\dbch\af15\loch\f6 TestbedSink1/work
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSink1/SE
\par 
\par \hich\af6\dbch\af15\loch\f6 Now register the node with the TMDB: in an SQL client
\par 
\par }{\dbch\f15\insrsid12207247\charrsid6378799 \tab \hich\af6\dbch\af15\loch\f6 NodeManager.pl add-node \\\\
\par \tab \tab \hich\af6\dbch\af15\loch\f6 -name TBSink1 \\\\
\par }{\dbch\f15\insrsid16283747\charrsid6378799 \tab \tab \hich\af6\dbch\af15\loch\f6 -host $NODETESTBED}{\dbch\f15\insrsid12207247\charrsid6378799 \hich\af6\dbch\af15\loch\f6 /TestbedSink1/SE \\\\
\par \tab \tab \hich\af6\dbch\af15\loch\f6 -cat xmlcat}{\dbch\f15\insrsid16283747\charrsid6378799 \hich\af6\dbch\af15\loch\f6 alog_file:$NODETESTBED}{\dbch\f15\insrsid12207247\charrsid6378799 \hich\af6\dbch\af15\loch\f6 /TestbedCatalogue.xml \\\\
\par \tab \tab \hich\af6\dbch\af15\loch\f6 -db }{\dbch\f15\insrsid16283747\charrsid6378799 \hich\af6\dbch\af15\loch\f6  \lquote mysq\hich\af6\dbch\af15\loch\f6 l:database=V2TMDB;host=<host>\rquote  }{\dbch\f15\insrsid12207247\charrsid6378799 \\\\
\par }{\dbch\f15\insrsid16283747\charrsid6378799 \tab \tab \hich\af6\dbch\af15\loch\f6 -user phedex}{\dbch\f15\insrsid12207247\charrsid6378799 \hich\af6\dbch\af15\loch\f6  \\\\
\par }{\dbch\f15\insrsid16283747\charrsid6378799 \tab \tab \hich\af6\dbch\af15\loch\f6 -password phedex}{\dbch\f15\insrsid12207247\charrsid6378799 \hich\af6\dbch\af15\loch\f6  }{\dbch\f15\insrsid16283747\charrsid6378799 
\par 
\par \hich\af6\dbch\af15\loch\f6 Now create a route between the two
\par 
\par \tab }{\dbch\f15\insrsid16283747\charrsid16283747 \hich\af6\dbch\af15\loch\f6 NodeManager.pl new-neighbours \\\\
\par }\pard \s15\ql \fi720\li720\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin720\itap0\pararsid16283747 {\dbch\f15\insrsid16283747\charrsid16283747 \hich\af6\dbch\af15\loch\f6 -name TBSink1 \\\\
\par }\pard \s15\ql \li1440\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin1440\itap0\pararsid16283747 {\dbch\f15\insrsid16283747\charrsid16283747 \hich\af6\dbch\af15\loch\f6 -neighbours TBSource1 \\\\
\par \hich\af6\dbch\af15\loch\f6 -db 'mysql:database=V2TMDB;host=<host>' \\\\
\par \hich\af6\dbch\af15\loch\f6 -user phedex \\\\
\par \hich\af6\dbch\af15\loch\f6 -password ph\hich\af6\dbch\af15\loch\f6 edex}{\dbch\f15\insrsid12207247\charrsid16283747 
\par }\pard \s15\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid6378799 {\dbch\f15\insrsid6378799\charrsid6378799 
\par \hich\af6\dbch\af15\loch\f6 Now deploy the transfer agent
\par 
\par \tab \hich\af6\dbch\af15\loch\f6 cd TestbedSink1/scripts
\par }{\dbch\f15\insrsid16283747\charrsid6378799 \tab \hich\af6\dbch\af15\loch\f6 cp $NODETESTBED}{\dbch\f15\insrsid6378799\charrsid6378799 \hich\af6\dbch\af15\loch\f6 /AgentToolkitExamples/Dropbox/ExampleTransfer}{\dbch\f15\insrsid16283747\charrsid6378799 
\hich\af6\dbch\af15\loch\f6 *}{\dbch\f15\insrsid6378799\charrsid6378799 \hich\af6\dbch\af15\loch\f6  .
\par 
\par }{\dbch\f15\insrsid16283747\charrsid6378799 \hich\af6\dbch\af15\loch\f6 This will copy over two scripts: one}{\dbch\f15\insrsid6378799\charrsid6378799 \hich\af6\dbch\af15\loch\f6 
 is a master agent that handles the querying of the TMDB for new guids for transfer- it mana\hich\af6\dbch\af15\loch\f6 ges a}{\dbch\f15\insrsid16283747\charrsid6378799 \hich\af6\dbch\af15\loch\f6  pool of instances of the other script}{
\dbch\f15\insrsid6378799\charrsid6378799 \hich\af6\dbch\af15\loch\f6 , each of which handles a given transfer.
\par 
\par \hich\af6\dbch\af15\loch\f6 Now register the agent with the TMDB
\par \tab 
\par \tab }{\dbch\f15\insrsid16283747\charrsid16283747 \hich\af6\dbch\af15\loch\f6 NodeManager.pl add-agent \\\\
\par }\pard \s15\ql \fi720\li720\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin720\itap0\pararsid16283747 {\dbch\f15\insrsid16283747\charrsid16283747 \hich\af6\dbch\af15\loch\f6 -name TBSink_Transfer \\\\
\par \hich\af6\dbch\af15\loch\f6 -db 'mysql:database=V2TMDB;host=<host>' \\\\
\par \hich\af6\dbch\af15\loch\f6 -user phedex \\\\
\par \hich\af6\dbch\af15\loch\f6 -password phedex}{\dbch\f15\insrsid5772644\charrsid16283747 
\par }\pard \s15\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid6378799 {\dbch\f15\insrsid5772644\charrsid6378799 
\par \hich\af6\dbch\af15\loch\f6 \hich\f6 [ To do.. add description of deployment of routing agent\u8230\'85\loch\f6  ]}{\dbch\f15\insrsid6378799\charrsid6378799 
\par }{\dbch\f15\insrsid5772644\charrsid6378799 
\par }{\dbch\f15\insrsid6378799\charrsid6378799 
\par 
\par \hich\af6\dbch\af15\loch\f6 2e. Deploying a simple management node
\par \hich\af6\dbch\af15\loch\f6 --------------------------------------
\par }{\dbch\f15\insrsid5772644\charrsid6378799 
\par \hich\af6\dbch\af15\loch\f6 Create a simple management node with allocator agent. First define the directory structure
\par 
\par }{\dbch\f15\insrsid16283747\charrsid6378799 \tab \hich\af6\dbch\af15\loch\f6 cd $NODETESTBED}{\dbch\f15\insrsid5772644\charrsid6378799 
\par \tab \hich\af6\dbch\af15\loch\f6 mkdi\hich\af6\dbch\af15\loch\f6 r TestbedManagement
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedManagement/scripts
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedManagement/logs
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedManagement/work
\par 
\par \hich\af6\dbch\af15\loch\f6 Note that the management node has no storage space, no SE.
\par 
\par \hich\af6\dbch\af15\loch\f6 Now register the node with the TMDB: in an SQL client
\par }{\dbch\f15\insrsid12207247\charrsid6378799 
\par \tab \hich\af6\dbch\af15\loch\f6 NodeManager.pl add-node \\\\
\par \tab \tab \hich\af6\dbch\af15\loch\f6 -name TBManagement \\\\
\par \tab \tab \hich\af6\dbch\af15\loch\f6 -host . \\\\
\par \tab \tab \hich\af6\dbch\af15\loch\f6 -cat . \\\\
\par }\pard \s15\ql \fi720\li720\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin720\itap0\pararsid16283747 {\dbch\f15\insrsid16283747\charrsid16283747 \hich\af6\dbch\af15\loch\f6 -db 'mysql:database=V2TMDB;host=<host>' \\\\
\par \hich\af6\dbch\af15\loch\f6 -user phedex \\\\
\par \hich\af6\dbch\af15\loch\f6 -password phedex
\par }\pard \s15\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid6378799 {\dbch\f15\insrsid12207247\charrsid6378799 
\par }{\dbch\f15\insrsid5772644\charrsid6378799 
\par \hich\af6\dbch\af15\loch\f6 \hich\f6 [ To do\u8230\'85\loch\f6 \hich\f6  need to allow null entries here\u8230\'85\loch\f6  ]
\par 
\par \hich\af6\dbch\af15\loch\f6 Now deploy the management script
\par 
\par \tab \hich\af6\dbch\af15\loch\f6 cd TestbedManagement/scripts
\par }{\dbch\f15\insrsid16283747\charrsid6378799 \tab \hich\af6\dbch\af15\loch\f6 cp $NODETESTBED}{\dbch\f15\insrsid5772644\charrsid6378799 \hich\af6\dbch\af15\loch\f6 /Ag\hich\af6\dbch\af15\loch\f6 entToolkitExamples/Managers/Allocator.pl}{
\dbch\f15\insrsid16283747\charrsid6378799 \hich\af6\dbch\af15\loch\f6  .}{\dbch\f15\insrsid6378799\charrsid6378799 
\par 
\par }{\dbch\f15\insrsid5772644\charrsid6378799 
\par }{\dbch\f15\insrsid6378799\charrsid6378799 
\par \hich\af6\dbch\af15\loch\f6 3. }{\dbch\f15\insrsid5772644\charrsid6378799 \hich\af6\dbch\af15\loch\f6 One-time }{\dbch\f15\insrsid6378799\charrsid6378799 \hich\af6\dbch\af15\loch\f6 Use
\par \hich\af6\dbch\af15\loch\f6 ------}{\dbch\f15\insrsid5772644\charrsid6378799 \hich\af6\dbch\af15\loch\f6 ---------}{\dbch\f15\insrsid6378799\charrsid6378799 
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 3a. Making test data available at a simple source node
\par \hich\af6\dbch\af15\loch\f6 ------------------------------------------------------
\par 
\par \hich\af6\dbch\af15\loch\f6 Now create some test files residing at the simple source node}{\dbch\f15\insrsid16283747\charrsid6378799 \hich\af6\dbch\af15\loch\f6 : m\hich\af6\dbch\af15\loch\f6 
ake sure that $POOL_CATALOG is set to xmlcatalog_file:$NODETESTBED/TestbedCatalogue.xml, then}{\dbch\f15\insrsid6378799\charrsid6378799 
\par 
\par \tab \hich\af6\dbch\af15\loch\f6 cd /NodeTestbed/TestbedSource1/SE
\par \tab \hich\af6\dbch\af15\loch\f6 CreateTestFiles }{\dbch\f15\insrsid16283747\charrsid6378799 \\\\
\par }\pard \s15\ql \fi720\li720\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin720\itap0\pararsid16283747 {\dbch\f15\insrsid6378799\charrsid6378799 \hich\af6\dbch\af15\loch\f6 5 }{\dbch\f15\insrsid16283747\charrsid6378799 \\\\
\par }\pard \s15\ql \li1440\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin1440\itap0\pararsid16283747 {\dbch\f15\insrsid6378799\charrsid6378799 \hich\af6\dbch\af15\loch\f6 TBSource1}{\dbch\f15\insrsid16283747\charrsid6378799 
\hich\af6\dbch\af15\loch\f6  \\\\
\par \lquote \hich\af6\dbch\af15\loch\f6 mysql:database=V2TMDB;host=<host>\rquote  \\\\
\par \hich\af6\dbch\af15\loch\f6 phedex \\\\
\par \hich\af6\dbch\af15\loch\f6 phedex}{\dbch\f15\insrsid6378799\charrsid6378799 
\par }\pard \s15\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid6378799 {\dbch\f15\insrsid6378799\charrsid6378799 
\par \hich\af6\dbch\af15\loch\f6 The CreateTestFiles script (in \hich\af6\dbch\af15\loch\f6 
the NodeTestbedToolkit dir) acts as a simple fake source of data, generating some testfiles, registering them with the file catalogue and then entering them into the TMDB.
\par }{\dbch\f15\insrsid5772644\charrsid6378799 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 3a\rquote . Cleaning up- removing test data from a node
\par \hich\af6\dbch\af15\loch\f6 --------------------------------\hich\af6\dbch\af15\loch\f6 ----------------
\par 
\par \hich\af6\dbch\af15\loch\f6 To remove test data from the system
\par \tab 
\par \tab \hich\af6\dbch\af15\loch\f6 cd /NodeTestbed/TestbedSource1/SE
\par \tab \hich\af6\dbch\af15\loch\f6 DeleteTestFiles}{\dbch\f15\insrsid16283747\charrsid6378799 \hich\af6\dbch\af15\loch\f6  \\\\
\par }\pard \s15\ql \li1440\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin1440\itap0\pararsid16283747 {\dbch\f15\insrsid16283747\charrsid6378799 \lquote \hich\af6\dbch\af15\loch\f6 mysql:database=V2TMDB;host=<host>\rquote  \\\\
\par \hich\af6\dbch\af15\loch\f6 phedex \\\\
\par \hich\af6\dbch\af15\loch\f6 phedex\tab \tab }{\dbch\f15\insrsid5772644\charrsid6378799 
\par }\pard \s15\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid6378799 {\dbch\f15\insrsid5772644\charrsid6378799 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 3b. Subscribing a sink node to certain data streams
\par \hich\af6\dbch\af15\loch\f6 ---------------------------------------------------
\par 
\par \hich\af6\dbch\af15\loch\f6 CreateTestFiles adds a metadata tag to e\hich\af6\dbch\af15\loch\f6 
ach file it creates in the TMDB- in t_replica_metadata it sets the key POOL_dataset to NodeTestbedSet. A sink can subscribe to a set of datasets by making an entry in the TMDB t_subscriptions table [this functionality will be offered by a web page].
\par 
\par \hich\af6\dbch\af15\loch\f6 In an\hich\af6\dbch\af15\loch\f6  SQL client
\par 
\par \tab \hich\af6\dbch\af15\loch\f6 insert into t_subscriptions values (\lquote TBSink1\rquote ,\rquote NodeTestbedSet\rquote );
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 3b. Using the allocator agent to allocate files to a sink node
\par \hich\af6\dbch\af15\loch\f6 --------------------------------------------------------------
\par 
\par \hich\af6\dbch\af15\loch\f6 We can run the allocator once to pick up the ne\hich\af6\dbch\af15\loch\f6 w files and allocate them to the sink based on the subscription information in the TMDB.
\par 
\par \tab \hich\af6\dbch\af15\loch\f6 cd /NodeTestbed/TestbedManagement/scripts
\par \tab \hich\af6\dbch\af15\loch\f6 ./Allocator.pl \endash no-updates \endash once \endash period 1 \endash w ../work \\
\par }\pard \s15\ql \fi720\li720\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin720\itap0\pararsid5772644 {\dbch\f15\insrsid5772644\charrsid6378799 \endash \hich\af6\dbch\af15\loch\f6 db <your_tmdb_tnsname>}{\dbch\f15\insrsid662841\charrsid6378799 

\par \hich\af6\dbch\af15\loch\f6 -user <your tmdb username>
\par \hich\af6\dbch\af15\loch\f6 -passwd <your t\hich\af6\dbch\af15\loch\f6 mdb passwd>}{\dbch\f15\insrsid5772644\charrsid6378799 
\par }\pard \s15\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid6378799 {\dbch\f15\insrsid5772644\charrsid6378799 \tab 
\par \hich\af6\dbch\af15\loch\f6 \hich\f6 This runs the allocator agent once without making any updates on the TMDB\u8230\'85\loch\f6 
 it should display a log indicating that it found the 5 new files created above, and indicating which destinations it would allocate those files. Note that if we hadn\rquote t\hich\af6\dbch\af15\loch\f6  made a subscription above, and if we hadn\rquote 
\hich\f6 t specified no-updates, the allocator would make a blank entry in the subscriptions table to warn a distribution manager that a new dataset had entered distribution and needed toe be allocated to a destination\u8230\'85}{
\dbch\f15\insrsid6378799\charrsid6378799 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 3}{\dbch\f15\insrsid5772644\charrsid6378799 \hich\af6\dbch\af15\loch\f6 c}{\dbch\f15\insrsid6378799\charrsid6378799 \hich\af6\dbch\af15\loch\f6 . Using transfer agents to transfer data to a simple sink node
\par \hich\af6\dbch\af15\loch\f6 ----------------------------------------------------------------}{\dbch\f15\insrsid5772644\charrsid6378799 
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 4. Steady-state use
\par \hich\af6\dbch\af15\loch\f6 -------------------}{\dbch\f15\insrsid6378799\charrsid6378799 
\par }}