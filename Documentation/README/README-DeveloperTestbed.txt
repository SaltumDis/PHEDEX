{\rtf1\mac\ansicpg10000\uc1\deff0\stshfdbch0\stshfloch0\stshfhich0\stshfbi0\deflang1033\deflangfe1033{\upr{\fonttbl{\f0\fnil\fcharset256\fprq2{\*\panose 00020206030504050203}Times New Roman;}
{\f6\fnil\fcharset256\fprq2{\*\panose 00020005000000000000}Courier;}{\f15\fnil\fcharset78\fprq2 \'82l\'82r \'96\'be\'92\'a9;}}{\*\ud{\fonttbl{\f0\fnil\fcharset256\fprq2{\*\panose 00020206030504050203}Times New Roman;}
{\f6\fnil\fcharset256\fprq2{\*\panose 00020005000000000000}Courier;}{\f15\fnil\fcharset78\fprq2 \u-211 _\u-205 _ \u26126 _\u26397 _;}}}}{\colortbl;\red0\green0\blue0;\red0\green0\blue255;\red0\green255\blue255;\red0\green255\blue0;\red255\green0\blue255;
\red255\green0\blue0;\red255\green255\blue0;\red255\green255\blue255;\red0\green0\blue128;\red0\green128\blue128;\red0\green128\blue0;\red128\green0\blue128;\red128\green0\blue0;\red128\green128\blue0;\red128\green128\blue128;\red192\green192\blue192;}
{\stylesheet{\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 \lang2057\langfe1033\cgrid\langnp2057\langfenp1033 \snext0 Normal;}{\*\cs10 \additive Default Paragraph Font;}{\*
\ts11\tsrowd\trftsWidthB3\trpaddl108\trpaddr108\trpaddfl3\trpaddft3\trpaddfb3\trpaddfr3\trcbpat1\trcfpat1\tscellwidthfts0\tsvertalt\tsbrdrt\tsbrdrl\tsbrdrb\tsbrdrr\tsbrdrdgl\tsbrdrdgr\tsbrdrh\tsbrdrv 
\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 \fs20\lang1024\langfe1024\cgrid\langnp1024\langfenp1024 \snext11 Normal Table;}{\s15\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 
\f6\lang2057\langfe1033\cgrid\langnp2057\langfenp1033 \sbasedon0 \snext15 \styrsid6378799 Plain Text;}}{\*\listtable{\list\listtemplateid-1201380266\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace0
\levelindent0{\leveltext\leveltemplateid-451376472\'02\'00.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1\fbias0 \fi-440\li800\jclisttab\tx800\lin800 }{\listlevel\levelnfc4\levelnfcn4\leveljc0\leveljcn0\levelfollow0
\levelstartat1\levelspace0\levelindent0{\leveltext\leveltemplateid67698713\'02\'01.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1 \fi-360\li1440\jclisttab\tx1440\lin1440 }{\listlevel\levelnfc2\levelnfcn2\leveljc2\leveljcn2
\levelfollow0\levelstartat1\levelspace0\levelindent0{\leveltext\leveltemplateid67698715\'02\'02.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1 \fi-180\li2160\jclisttab\tx2160\lin2160 }{\listlevel\levelnfc0\levelnfcn0\leveljc0
\leveljcn0\levelfollow0\levelstartat1\levelspace0\levelindent0{\leveltext\leveltemplateid67698703\'02\'03.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1 \fi-360\li2880\jclisttab\tx2880\lin2880 }{\listlevel\levelnfc4\levelnfcn4
\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace0\levelindent0{\leveltext\leveltemplateid67698713\'02\'04.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1 \fi-360\li3600\jclisttab\tx3600\lin3600 }{\listlevel\levelnfc2
\levelnfcn2\leveljc2\leveljcn2\levelfollow0\levelstartat1\levelspace0\levelindent0{\leveltext\leveltemplateid67698715\'02\'05.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1 \fi-180\li4320\jclisttab\tx4320\lin4320 }{\listlevel
\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace0\levelindent0{\leveltext\leveltemplateid67698703\'02\'06.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1 \fi-360\li5040\jclisttab\tx5040\lin5040 }
{\listlevel\levelnfc4\levelnfcn4\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace0\levelindent0{\leveltext\leveltemplateid67698713\'02\'07.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1 \fi-360\li5760
\jclisttab\tx5760\lin5760 }{\listlevel\levelnfc2\levelnfcn2\leveljc2\leveljcn2\levelfollow0\levelstartat1\levelspace0\levelindent0{\leveltext\leveltemplateid67698715\'02\'08.;}{\levelnumbers\'01;}\chbrdr\brdrnone\brdrcf1 \chshdng0\chcfpat1\chcbpat1 
\fi-180\li6480\jclisttab\tx6480\lin6480 }{\listname ;}\listid1356925417}}{\*\listoverridetable{\listoverride\listid1356925417\listoverridecount0\ls1}}{\*\rsidtbl \rsid6378799}{\info{\title Node Testbed deployment and user guide}{\author Tim Barrass}
{\operator Tim Barrass}{\creatim\yr2004\mo7\dy28\hr12\min36}{\revtim\yr2004\mo7\dy28\hr12\min36}{\version2}{\edmins8}{\nofpages1}{\nofwords497}{\nofchars2836}{\*\company University of Bristol}{\nofcharsws3482}{\vern24577}}\margl359\margr359 
\ftnbj\aenddoc\noxlattoyen\expshrtn\noultrlspc\dntblnsbdb\nospaceforul\formshade\horzdoc\dghspace180\dgvspace180\dghorigin1701\dgvorigin1984\dghshow0\dgvshow0
\jexpand\viewkind4\viewscale100\pgbrdrhead\pgbrdrfoot\splytwnine\ftnlytwnine\htmautsp\nolnhtadjtbl\useltbaln\alntblind\lytcalctblwd\lyttblrtgr\lnbrkrule\nobrkwrptbl\rsidroot12669697 \fet0\sectd 
\linex0\headery708\footery708\colsx708\endnhere\sectdefaultcl\sectrsid6378799\sftnbj {\*\pnseclvl1\pnucrm\pnstart1\pnindent720\pnhang{\pntxta .}}{\*\pnseclvl2\pnucltr\pnstart1\pnindent720\pnhang{\pntxta .}}{\*\pnseclvl3\pndec\pnstart1\pnindent720\pnhang
{\pntxta .}}{\*\pnseclvl4\pnlcltr\pnstart1\pnindent720\pnhang{\pntxta )}}{\*\pnseclvl5\pndec\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl6\pnlcltr\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl7
\pnlcrm\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl8\pnlcltr\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl9\pnlcrm\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}\pard\plain 
\s15\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid6378799 \f6\lang2057\langfe1033\cgrid\langnp2057\langfenp1033 {\dbch\f15\insrsid6378799\charrsid6378799 \hich\af6\dbch\af15\loch\f6 
Node Testbed deployment and user guide
\par }\pard\plain \ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid6378799 \lang2057\langfe1033\cgrid\langnp2057\langfenp1033 {\dbch\f15\insrsid6378799\charrsid6378799 \hich\af0\dbch\af15\loch\f0 
========================================}{\f6\insrsid6378799 
\par }\pard\plain \s15\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0\pararsid6378799 \f6\lang2057\langfe1033\cgrid\langnp2057\langfenp1033 {\dbch\f15\insrsid6378799\charrsid6378799 
\par \hich\af6\dbch\af15\loch\f6 1. Introduction
\par \hich\af6\dbch\af15\loch\f6 ---------------
\par 
\par \hich\af6\dbch\af15\loch\f6 It is possible to set up a testbed network of PhEDEx distribution nodes on a single machine. The nodes manage Storage Elements which are simply local director\hich\af6\dbch\af15\loch\f6 
ies, copying files between them using cp. Files are registered in a testbed-global POOL XML catalogue (i.e. just an easily accessible file). Currently updates into an Oracle Transfer Management Database are used.
\par 
\par \hich\af6\dbch\af15\loch\f6 This document details the deployment and u\hich\af6\dbch\af15\loch\f6 se of such a testbed system.
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 2. Deployment
\par \hich\af6\dbch\af15\loch\f6 -------------
\par 
\par \hich\af6\dbch\af15\loch\f6 This section details the process of setting up a simple testbed, with a simple source of data, a simple sink of data and the management infrastructure needed to link agents together.
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 2a. Requirements
\par \hich\af6\dbch\af15\loch\f6 ----------------
\par 
\par \hich\af6\dbch\af15\loch\f6 Linux\hich\af6\dbch\af15\loch\f6  rh73 machine with gcc32
\par \hich\af6\dbch\af15\loch\f6 AFS access to CERN (for POOL File Catalogue tools)
\par \hich\af6\dbch\af15\loch\f6 Access to Oracle clients
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 2a. TMDB deployment
\par \hich\af6\dbch\af15\loch\f6 -------------------
\par 
\par \hich\af6\dbch\af15\loch\f6 \hich\f6 To do \u8230\'85
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 2b. Downloading the testbed tools
\par \hich\af6\dbch\af15\loch\f6 ---------------------------------
\par 
\par \hich\af6\dbch\af15\loch\f6 Begin to create the testbed directory structure. On your chosen testbed machine
\par 
\par \tab \hich\af6\dbch\af15\loch\f6 mkd\hich\af6\dbch\af15\loch\f6 ir /NodeTestbed
\par 
\par \tab \hich\af6\dbch\af15\loch\f6 setenv CVSROOT \\ \tab \tab \tab \tab :pserver:anonymous@cmscvs.cern.ch:/cvs_server/repositories/TMAgents
\par \tab 
\par \tab \hich\af6\dbch\af15\loch\f6 cvs login
\par \tab \tab \hich\af6\dbch\af15\loch\f6 [ password is 98passwd ]
\par \tab \hich\af6\dbch\af15\loch\f6 cvs co AgentToolkitExamples
\par 
\par \tab \hich\af6\dbch\af15\loch\f6 cd AgentToolkitExamples/NodeTestbedToolkit
\par \tab \hich\af6\dbch\af15\loch\f6 source SetupEnv\hich\af6\dbch\af15\loch\f6 ironment.csh
\par 
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 2c. Deploying a simple (not full-functionality) source node
\par \hich\af6\dbch\af15\loch\f6 -----------------------------------------------------------
\par 
\par \hich\af6\dbch\af15\loch\f6 Now create a node. First we define the directory structure
\par 
\par \tab \hich\af6\dbch\af15\loch\f6 cd /NodeTestbed
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSource1
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSource1/scripts
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSource1/logs
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSource1/\hich\af6\dbch\af15\loch\f6 work
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSource1/SE
\par 
\par \hich\af6\dbch\af15\loch\f6 Now register the node with the TMDB: in an SQL client
\par 
\par \tab \hich\af6\dbch\af15\loch\f6 insert into t_nodes values
\par \tab \tab \hich\af6\dbch\af15\loch\f6 (\lquote TBSource1\rquote ,
\par \tab \tab \rquote \hich\af6\dbch\af15\loch\f6 /NodeTestbed/TestbedSource1/SE\rquote ,
\par \tab \tab \rquote \hich\af6\dbch\af15\loch\f6 xmlcatalogue_file:/NodeTestbed/TestbedCatalogue.xml\rquote );
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 2d. Deploying a simple sink node
\par \hich\af6\dbch\af15\loch\f6 --------------------------------
\par 
\par \hich\af6\dbch\af15\loch\f6 Now cr\hich\af6\dbch\af15\loch\f6 eate a simple sink node with a \hich\af6\dbch\af15\loch\f6 transfer agent.\hich\af6\dbch\af15\loch\f6  First define the directory structure
\par 
\par \tab \hich\af6\dbch\af15\loch\f6 cd /NodeTestbed
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSink\hich\af6\dbch\af15\loch\f6 1
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSink\hich\af6\dbch\af15\loch\f6 1/scripts
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSink\hich\af6\dbch\af15\loch\f6 1/logs
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSink\hich\af6\dbch\af15\loch\f6 1/\hich\af6\dbch\af15\loch\f6 work
\par \tab \hich\af6\dbch\af15\loch\f6 mkdir TestbedSink\hich\af6\dbch\af15\loch\f6 1/SE
\par 
\par \hich\af6\dbch\af15\loch\f6 Now register the node with the TMDB: in an SQL client
\par 
\par \tab \hich\af6\dbch\af15\loch\f6 insert into t_nodes values
\par \tab \tab \hich\af6\dbch\af15\loch\f6 (\lquote TBSink\hich\af6\dbch\af15\loch\f6 1\rquote ,
\par \tab \tab \rquote \hich\af6\dbch\af15\loch\f6 /NodeTestbed/TestbedSink\hich\af6\dbch\af15\loch\f6 1/SE\rquote ,
\par \tab \tab \rquote \hich\af6\dbch\af15\loch\f6 xmlcatalogue_file:/NodeTestbed/TestbedCatalogue.xml\rquote );
\par 
\par \hich\af6\dbch\af15\loch\f6 Now deploy the transfer agent
\par 
\par \tab \hich\af6\dbch\af15\loch\f6 cd TestbedSink1/scripts
\par \tab \hich\af6\dbch\af15\loch\f6 cp /NodeTestbed/AgentToolkitExamples/Dropbox/ExampleTransfer\hich\af6\dbch\af15\loch\f6  .
\par \tab \hich\af6\dbch\af15\loch\f6 cp /NodeTestbed/AgentToolkitExamples/Dropbox/ExampleTransfer\hich\af6\dbch\af15\loch\f6 Slave\hich\af6\dbch\af15\loch\f6  .
\par 
\par \hich\af6\dbch\af15\loch\f6 The first is a master agent that handles the querying of the TMDB for new guids for transfer- it manages a pool of instances of the second, each of which handles a given transfer.
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 2e. Deploying a simple management node
\par \hich\af6\dbch\af15\loch\f6 --------------------------------------
\par 
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 3. Use
\par \hich\af6\dbch\af15\loch\f6 ------
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 3a. Making test data available at a simple source node
\par \hich\af6\dbch\af15\loch\f6 ------------------------------------------------------
\par 
\par \hich\af6\dbch\af15\loch\f6 Now create some test files resi\hich\af6\dbch\af15\loch\f6 ding at the \hich\af6\dbch\af15\loch\f6 simple source \hich\af6\dbch\af15\loch\f6 node
\par 
\par \tab \hich\af6\dbch\af15\loch\f6 cd \hich\af6\dbch\af15\loch\f6 /NodeTestbed/\hich\af6\dbch\af15\loch\f6 TestbedSource1/SE
\par \tab \hich\af6\dbch\af15\loch\f6 CreateTestFiles\hich\af6\dbch\af15\loch\f6  5 TBSource1
\par 
\par \hich\af6\dbch\af15\loch\f6 The CreateTestFiles script (in the NodeTestbedToolkit dir) acts as a simple fake source of data, generating some testfiles, registering them with the file catalogue and then entering them into the TMDB.
\par 
\par 
\par 
\par 
\par \hich\af6\dbch\af15\loch\f6 3b. Using transfer agents to transfer data to a s\hich\af6\dbch\af15\loch\f6 imple sink node
\par \hich\af6\dbch\af15\loch\f6 ----------------------------------------------------------------
\par }}