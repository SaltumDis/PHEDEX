<!DOCTYPE HTML PUBLIC “-//W3C//DTD HTML 4.01//EN” “http://www.w3.org/TR/html4/strict.dtd”>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-15" />
<!--define basic CSS for the body here (fonts etc), so the page doesn't wobble when css files get loaded later.-->
  <style type='text/css'>
    body {
      margin:	0;
      margin-left:	1em;
      padding:	0;
      font-size:	80%;
      font-family:	'Lucida Grande', verdana, helvetica, arial, sans-serif;
      line-height:	1.6em;
    }
  </style>
</head>

<body class="yui-skin-sam">
 <div class='phedex-banner'>
    <img src="/phedex/datasvc/app/images/phedex-logo-small.gif" alt="PhEDEx" height="20" />
    <b>PhEDEx Next-Gen Web Application - v.<span id='phedex-app-version'></span></b> -
    <a target='new_twiki' href="https://twiki.cern.ch/twiki/bin/view/CMS/PhedexProjWebsite">plan</a> -
    <a href="mailto:cms-phedex-admins@cern.ch">feedback mail</a> -
    <a target='new_bugs' href="https://savannah.cern.ch/bugs/?func=additem&group=phedex">bugs/feature req.</a>
    <span id='phedex-banner-messages' style='margin-left:20px;'>Loading, please be patient...</span>
    <div id='phedex-controls' class='phedex-controls float-right'></div>
 </div>
 <div id='phedex-nav'></div>
 <div id='phedex-logger' class='phedex-logger'>
  <div id='phedex-logger-inner' class='phedex-logger-inner'></div>
 </div>
 <div id='phedex-main'></div>
</body>

<script type="text/javascript" src="/yui/build/yuiloader-dom-event/yuiloader-dom-event.js"></script>
<script type="text/javascript" src="/js/phedex-base.js"></script>
<script type="text/javascript" src="/js/phedex-loader.js"></script>
<script type="text/javascript">

// a simple logging function, to show it all working. This is overridden by PHEDEX.Logger, later.
log = function() {
  var _buffer = [];
  return function(str,level,group) {
    var el = document.getElementById('phedex-logger-inner');
    if ( str ) {
      if ( el ) {
	el.innerHTML += str+'<br/>';
	if (typeof el.scrollTop != 'undefined') { el.scrollTop += 100; }
      }
    _buffer.push([str,level,group]);
    } else {
      return _buffer;
    }
  };
}();

banner = function() {
  return function(str,level,group) {
    var el = document.getElementById('phedex-banner-messages');
    if ( el ) {
//       if ( str ) {
	el.innerHTML = str;
//       }
    }
  };
}();

YAHOO.util.Event.onDOMReady(function() {
  banner('Loading core application');
// dynamic loader for PhEDEx and YUI. This is for the global app to use
  PxL  = new PHEDEX.Loader();
  PxL.load(createCoreApp,'phedex-core-app','phedex-core-module','phedex-sandbox');

// create another loader, to load and instantiate the logger. This shows how to 'multi-thread' with the loader
  PHEDEX.Loader().load(function() {
    PHEDEX.Logger.Create();
    var ctl = new PHEDEX.Core.Control({
        text:'Show Logger',
        payload:{render:'phedex-controls', target:'phedex-logger'},
        className: 'float-right phedex-core-control-widget phedex-core-control-widget-inactive',
      }
    );
  },'phedex-core-logger','phedex-core-control');
});

var phedexMain = document.getElementById('phedex-main');
function createCoreApp() {
// Now I can create the core application, but also, start loading the YAHOO logger
  banner('Create sandbox and core application...');
  PxS = new PHEDEX.Sandbox();
  PxC = new PHEDEX.Core.App(PxS);
  PxC.create();

  banner('Core application is running, create PhEDEx data-modules...');
  PxC.createModule('Nodes');
  setTimeout(function() { banner(''); }, 5000);
};
</script>
</html>