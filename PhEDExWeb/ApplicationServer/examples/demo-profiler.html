<!DOCTYPE HTML PUBLIC “-//W3C//DTD HTML 4.01//EN” “http://www.w3.org/TR/html4/strict.dtd”>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <title>PhEDEx Web Application</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-15" />
<!--define basic CSS for the body here (fonts etc), so the page doesn't wobble when css files get loaded later.-->
  <style type='text/css'>
    body {
      margin:           0;
      margin-left:      1em;
      padding:          0;
      font-size:        80%;
      font-family:      'Lucida Grande', verdana, helvetica, arial, sans-serif;
      line-height:      1.6em;
    }
  </style>
</head>

<body class="yui-skin-sam">
 <iframe id="yui-history-iframe" src="/phedex/datasvc/app/images/phedex-logo-small.gif" style='visibility:hidden'></iframe>
 <input id="yui-history-field" type="hidden" style='visibility:hidden'>
 <div class='phedex-banner'>
    <a href='' id='phedex-link-home' title='Reset application to initial state' style='text-decoration:none'>
      <img src="/phedex/datasvc/app/images/phedex-logo-small.gif" alt="PhEDEx" height="20" style='border:none'/>
    </a>
    <b>PhEDEx Next-Gen Web Application - v.<span id='phedex-app-version'></span></b> -
    <span id='phedex-banner-messages-outer' class='phedex-messages-outer'>
      <span id='phedex-banner-messages-inner' class='phedex-messages-inner'>Loading, please be patient...</span>
    </span>
    <div id='phedex-controls' class='phedex-controls float-right'></div>
 </div>
 <div id='phedex-login'></div>
 <div id='phedex-navigator'></div>
 <div id='phedex-globalfilter'></div>
 <div class='phedex-separator'></div>
 <div id='phedex-profiler' class='phedex-logger'></div>
 <div id='phedex-main'></div>
 <div id='phedex-history'></div>


<script type="text/javascript" src="/phedex/datasvc/app/yui/build/yuiloader-dom-event/yuiloader-dom-event.js"></script>
<script type="text/javascript" src="/phedex/datasvc/app/js/phedex-base.js"></script>
<script type="text/javascript" src="/phedex/datasvc/app/js/phedex-loader.js"></script>
<script type="text/javascript">

// This is a class for an object that just burns CPU
MyObj = function() {
  return {
    busy: function(arg) {
      if ( !arg ) { return; }
      var result=1, i;
      for (i=2; i<arg; i++) { result = result*i; }
      return result;
    },
    busier: function(arg) {
      this.busy(arg);
      this.busy(arg);
      this.busy(arg);
    }
  };
}

// This is an infinite loop, using setTimeout to make it a little less hard on the CPU
beBusy = function(a,b) {
  a.busy(70);
  a.busier(70);
  b.busy(50);
  setTimeout(function() { beBusy(a,b); }, 100);
}

// When the DOM is available, start loading the essential bits and pieces
// This is where the real application starts.
YAHOO.util.Event.onDOMReady(function() {
  PHEDEX.Appserv.combineRequests = false;
  log('initialising','info','app');
  PxL  = new PHEDEX.Loader();
  banner('Loading profiler...');
  PxL.load(createCoreApp,'phedex-profiler');
});

function createCoreApp() {
// This is called once the core is fully loaded. Now I can create the core application and sandbox, and then start creating PhEDEx modules
  banner('Profiler is loaded, wait a few seconds for the results...');

  var a = new MyObj(),
      b = new MyObj();
  YtP.registerObject('Object_a',a);
  YtP.registerObject('Object_b',b);
  PHEDEX.Profiler.interval(6000); // update profile results every 6 seconds
  PHEDEX.Profiler.threshold(3);   // show only functions taking over 3% of the CPU
  beBusy(a,b);
};
</script>
</body>
</html>