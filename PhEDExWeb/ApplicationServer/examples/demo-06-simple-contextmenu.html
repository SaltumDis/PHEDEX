<!DOCTYPE HTML PUBLIC “-//W3C//DTD HTML 4.01//EN” “http://www.w3.org/TR/html4/strict.dtd”>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <title>PhEDEx Web Interface</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-15" />

  <!-- YUI stylesheets-->
  <link rel="stylesheet" type="text/css" href="/yui/build/treeview/assets/skins/sam/treeview.css">
  <link rel="stylesheet" type="text/css" href="/yui/build/datatable/assets/skins/sam/datatable.css">
  <link rel="stylesheet" type="text/css" href="/yui/build/container/assets/container-core.css">
  <link rel="stylesheet" type="text/css" href="/yui/build/resize/assets/skins/sam/resize.css"> 
  <link rel="stylesheet" type="text/css" href="/yui/build/logger/assets/skins/sam/logger.css">
  <link rel="stylesheet" type="text/css" href="/yui/build/menu/assets/skins/sam/menu.css">
  <link rel="stylesheet" type="text/css" href="/yui/examples/treeview/assets/css/menu/tree.css">
  <link rel="stylesheet" type="text/css" href="/yui/build/button/assets/button-core.css">
  <link rel="stylesheet" type="text/css" href="/yui/build/assets/skins/sam/button.css">
  <link rel="stylesheet" type="text/css" href="/yui/build/fonts/fonts-min.css" />

  <!-- YUI libs -->
  <script type="text/javascript" src="/yui/build/yahoo-dom-event/yahoo-dom-event.js"></script>
  <script type="text/javascript" src="/yui/build/connection/connection-min.js"></script>
  <script type="text/javascript" src="/yui/build/json/json-min.js"></script>
  <script type="text/javascript" src="/yui/build/treeview/treeview-min.js"></script>
  <script type="text/javascript" src="/yui/build/logger/logger-min.js"></script>
  <script type="text/javascript" src="/yui/build/dragdrop/dragdrop-min.js"></script>
  <script type="text/javascript" src="/yui/build/element/element-min.js"></script>
  <script type="text/javascript" src="/yui/build/datasource/datasource-min.js"></script>
  <script type="text/javascript" src="/yui/build/datatable/datatable-min.js"></script>
  <script type="text/javascript" src="/yui/build/animation/animation-min.js"></script>
  <script type="text/javascript" src="/yui/build/container/container-min.js"></script>
  <script type="text/javascript" src="/yui/build/resize/resize-min.js"></script>
  <script type="text/javascript" src="/yui/build/menu/menu-min.js"></script>
  <script type="text/javascript" src="/yui/build/button/button-min.js"></script>

  <!-- PhEDEx stylesheets -->
  <link rel="stylesheet" type="text/css" href="/css/phedex.css">

  <!-- PhEDEx libs -->
  <script type="text/javascript" src="/js/phedex-base.js"></script>
  <script type="text/javascript" src="/js/phedex-core-logger.js"></script>
  <script type="text/javascript" src="/js/phedex-core-contextmenu.js"></script>
  <script type="text/javascript" src="/js/phedex-util.js"></script>
  <script type="text/javascript" src="/js/phedex-page.js"></script>
  <script type="text/javascript" src="/js/phedex-datasvc.js"></script>
  <script type="text/javascript" src="/js/phedex-event.js"></script>
  <script type="text/javascript" src="/js/phedex-core-control.js"></script>
  <script type="text/javascript" src="/js/phedex-core-filter.js"></script>
  <script type="text/javascript" src="/js/phedex-core-widget.js"></script>
  <script type="text/javascript" src="/js/phedex-core-widget-registry.js"></script>
  <script type="text/javascript" src="/js/phedex-core-widget-datatable.js"></script>
  <script type="text/javascript" src="/js/phedex-core-widget-treeview.js"></script>
  <script type="text/javascript" src="/js/phedex-widget-agents.js"></script>
  <script type="text/javascript" src="/js/phedex-widget-nodes.js"></script>
  <script type="text/javascript" src="/js/phedex-widget-linkview.js"></script>
  <script type="text/javascript" src="/js/phedex-widget-requestview.js"></script>
  <script type="text/javascript" src="/js/phedex-widget-template.js"></script>
</head>

<body class="yui-skin-sam">
 <div id='phedex-main'></div>

<script type="text/javascript">
// instantiate the page and other things when the DOM is ready!
YAHOO.util.Event.onDOMReady(function() {
    var phedexMain = document.getElementById('phedex-main');

//  Create some divs, attach a context-menu to each of them
    var text = [ 'foo', 'bar', 'baz' ];
    for (var i in text) {
      var el = document.createElement('div');
      el.innerHTML = text[i]; el.style.width = '200px'; el.style.border = '1px solid black';
      phedexMain.appendChild(el);
      var menu = PHEDEX.Core.ContextMenu.Create({trigger:el});
      menu.subscribe('beforeShow', onContextMenuBeforeShow);
      menu.subscribe('click',      onContextMenuClick);
    }

//  Build the menu on the fly, before it is displayed!
    function onContextMenuBeforeShow(event_name) {
      if (this.getRoot() != this) { return; } // Not sure what this means, but YUI use it in their examples!
      var tgt = this.contextEventTarget;

//    Now build the menu, using a few fixed options and some based on the div-contents
      var label = tgt.textContent;
      PHEDEX.Core.ContextMenu.Clear(this);
      PHEDEX.Core.ContextMenu.Build(this,['Yellow','White',label]);
      this.render();
    }

    function onContextMenuClick(event_name, event) {
      var tgt = this.contextEventTarget;
      var task  = event[1];
      if (task) {
	this.payload[task.index](tgt);
      }
    }

//  Declare some context-menu handlers
    var contextHandler_Bar = function(tgt)  { tgt.innerHTML = 'splot'; }
    PHEDEX.Core.ContextMenu.Add('bar', 'Set contents to splot', contextHandler_Bar);

    var contextHandler_Splot = function(tgt)  { tgt.innerHTML = 'bar'; }
    PHEDEX.Core.ContextMenu.Add('splot', 'Set contents to bar', contextHandler_Splot);

    var contextHandler_Yellow = function(tgt) { tgt.style.backgroundColor = 'yellow'; }
    PHEDEX.Core.ContextMenu.Add('Yellow','Yellow background',contextHandler_Yellow);

    var contextHandler_White = function(tgt)  { tgt.style.backgroundColor = 'white'; }
    PHEDEX.Core.ContextMenu.Add('White', 'White background', contextHandler_White);
});
</script>

</body>
</html>
