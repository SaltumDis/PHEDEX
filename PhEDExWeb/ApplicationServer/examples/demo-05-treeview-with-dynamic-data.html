<!DOCTYPE HTML PUBLIC “-//W3C//DTD HTML 4.01//EN” “http://www.w3.org/TR/html4/strict.dtd”>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <title>PhEDEx Web Interface</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-15" />

  <!-- YUI stylesheets-->
  <link rel="stylesheet" type="text/css" href="/yui/build/treeview/assets/skins/sam/treeview.css">
  <link rel="stylesheet" type="text/css" href="/yui/build/datatable/assets/skins/sam/datatable.css">
  <link rel="stylesheet" type="text/css" href="/yui/build/container/assets/container-core.css">
  <link rel="stylesheet" type="text/css" href="/yui/build/resize/assets/skins/sam/resize.css"> 
  <link rel="stylesheet" type="text/css" href="/yui/build/logger/assets/skins/sam/logger.css">
  <link rel="stylesheet" type="text/css" href="/yui/build/menu/assets/skins/sam/menu.css">
  <link rel="stylesheet" type="text/css" href="/yui/examples/treeview/assets/css/menu/tree.css">
  <link rel="stylesheet" type="text/css" href="/yui/build/button/assets/button-core.css">
  <link rel="stylesheet" type="text/css" href="/yui/build/assets/skins/sam/button.css">
  <link rel="stylesheet" type="text/css" href="/yui/build/fonts/fonts-min.css" />

  <!-- YUI libs -->
  <script type="text/javascript" src="/yui/build/yahoo-dom-event/yahoo-dom-event.js"></script>
  <script type="text/javascript" src="/yui/build/connection/connection-min.js"></script>
  <script type="text/javascript" src="/yui/build/json/json-min.js"></script>
  <script type="text/javascript" src="/yui/build/treeview/treeview-min.js"></script>
  <script type="text/javascript" src="/yui/build/logger/logger-min.js"></script>
  <script type="text/javascript" src="/yui/build/dragdrop/dragdrop-min.js"></script>
  <script type="text/javascript" src="/yui/build/element/element-min.js"></script>
  <script type="text/javascript" src="/yui/build/datasource/datasource-min.js"></script>
  <script type="text/javascript" src="/yui/build/datatable/datatable-min.js"></script>
  <script type="text/javascript" src="/yui/build/animation/animation-min.js"></script>
  <script type="text/javascript" src="/yui/build/container/container-min.js"></script>
  <script type="text/javascript" src="/yui/build/resize/resize-min.js"></script>
  <script type="text/javascript" src="/yui/build/menu/menu-min.js"></script>
  <script type="text/javascript" src="/yui/build/button/button-min.js"></script>

  <!-- PhEDEx stylesheets -->
  <link rel="stylesheet" type="text/css" href="/css/phedex.css">

  <!-- PhEDEx libs -->
  <script type="text/javascript" src="/js/phedex-base.js"></script>
  <script type="text/javascript" src="/js/phedex-core-logger.js"></script>
  <script type="text/javascript" src="/js/phedex-core-contextmenu.js"></script>
  <script type="text/javascript" src="/js/phedex-util.js"></script>
  <script type="text/javascript" src="/js/phedex-page.js"></script>
  <script type="text/javascript" src="/js/phedex-datasvc.js"></script>
  <script type="text/javascript" src="/js/phedex-core-control.js"></script>
  <script type="text/javascript" src="/js/phedex-core-widget.js"></script>
  <script type="text/javascript" src="/js/phedex-core-widget-datatable.js"></script>
  <script type="text/javascript" src="/js/phedex-core-widget-treeview.js"></script>
  <script type="text/javascript" src="/js/phedex-widget-agents.js"></script>
  <script type="text/javascript" src="/js/phedex-widget-nodes.js"></script>
  <script type="text/javascript" src="/js/phedex-widget-linkview.js"></script>
  <script type="text/javascript" src="/js/phedex-widget-requestview.js"></script>
  <script type="text/javascript" src="/js/phedex-widget-template.js"></script>
</head>

<body class="yui-skin-sam">
 <div id='phedex-main'></div>

<script type="text/javascript">
// instantiate the page and other things when the DOM is ready!
YAHOO.util.Event.onDOMReady(function() {
  My = {};
  My.Widget = function(div,args) {
    var that = new PHEDEX.Core.Widget.TreeView( div, args );
    var width = 800;
    var branchDef1 = [
          {width:170,text:'Node', className:'phedex-tree-demo-node', otherClasses:'align-left'}
      ];
    var branchDef2 = [
          {width:150,text:'Agent', className:'phedex-tree-demo-agent', otherClasses:'align-left'},
          {width:150,text:'Label', className:'phedex-tree-demo-label', otherClasses:'align-right'},
	  {width:150,text:'Date',  className:'phedex-tree-demo-date', format:PHEDEX.Util.format.date}
      ];
    that.buildHeader= function(div) {
      var root = that.headerTree.getRoot();
      var tNode1 = that.addNode( { width:width, format:branchDef1, name:'Top-level' }, null, root);    tNode1.expand();
      var tNode2 = that.addNode( {              format:branchDef2, name:'Thing' },     null, tNode1 ); tNode2.expand();
      tNode2.isLeaf = true;
      that.headerTree.render();
    }
    that.fillBody = function(div) {
      var root = that.tree.getRoot();
      var nodes = ['T0_CH_CERN_Export','T1_DE_FZK_Buffer','T1_ES_PIC_Buffer','T1_FR_CCIN2P3_Buffer','T1_IT_CNAF_Buffer','T1_TW_ASGC_Buffer','T1_UK_RAL_Buffer','T1_US_FNAL_Buffer'];
      for (var i in nodes) {
	var payload = { call:'agents', args:{node:nodes[i]}, callback:that.treeview_Callback, obj:that };
        that.addNode( {format:branchDef1, payload:payload}, [ nodes[i], ] );
      }
      that.tree.render();
    }
    that.treeview_Callback = function(node,result) {
      var agents = result.node[0].agent;
      for (var i in agents)
      {
        node.payload.obj.addNode(
          {format:branchDef2},
          [ agents[i].name, agents[i].label, agents[i].time_update ],
	  node
        );
        tNode.isLeaf = true;
      }
    }

    that.update = function() {
      that.receive();
    }
    that.receive = function() {
      that.populate();
    }

    that.isDynamic = true; // enable dynamic loading
    that.buildTree(that.dom.content);
    that.buildExtra(that.dom.extra);
    that.build();
    return that;
  }
  var widget = new My.Widget( 'phedex-main', {width:800, height:500, constraintoviewport:true, minwidth:250} );
  widget.update();
});
</script>

</body>
</html>
