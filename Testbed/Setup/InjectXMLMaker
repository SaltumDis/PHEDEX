#!/usr/bin/env perl

##H Make TMDBInject XMLs
##H
##H Example:
##H    InjectXMLMaker DATASET_NAME N_BLOCK N_FILE

use warnings;
use strict;

# Check arguments.
if (scalar @ARGV < 3)
{
  die "Insufficient parameters.\n";
}

my ($dataset, $blocks, $files) = @ARGV;

my $dbs = "test";
my $dls = "lfc:unknown";

my $xmlfile = "test.xml";
open XML, '>', $xmlfile or die $!;
print XML qq{<dbs name="$dbs"  dls="$dls">\n};
print XML qq{\t<dataset name="$dataset" is-open="n" is-transient="n">\n};
for my $n_block (1..$blocks) {
    my $block = $dataset . "#$n_block";
    print XML qq{\t\t<block name="$block" is-open="n">\n};
    for my $n_file (1..$files) {
	my $lfn = $dataset. "-${n_block}-${n_file}";
	my $filesize = int(rand() * 2 * (1024**3));
	my $cksum = 'cksum:'. int(rand() * (10**10));
	print XML qq{\t\t\t<file lfn="$lfn" size="$filesize" checksum="$cksum"/>\n};
    }
    print XML qq{\t\t</block>\n};
}
print XML qq{\t</dataset>\n};
print XML qq{</dbs>\n};
close XML;

print "Wrote injection file to $xmlfile\n";
