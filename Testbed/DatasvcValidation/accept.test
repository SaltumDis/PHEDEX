## This file contains tests for datasvc APIs
## Each test is in a line
##
## Lines beginning with "##" are internal comments, which will not show up in the output
##
## Lines beginning with single '#' are general comments, which are simply printed to the output
##
## Each non-empty line, other than comments, is a test in the following format
## [-]<call> [<key> [<count>]]
##
## <call>  : api call, may include arguments
##           if it begins with '-', a negative (ERROR) is expected
## <key>   : key of the result. if present, the count will be calculated
## <count> : is of this format: (>|<|=|>=|<=)<number>, a relational operator and the expected number.
##           when present, the result count is compared to this number according to the relational operator

# PHEDEX::Web::API::Agents - currently running agents
agents node
agents?node=T1_US_FNAL_MSS node
agents?agent=FileDownload node
agents?node=T1_US_FNAL_MSS&node=T1_US_FNAL_Buffer node
agents?se=cmssrm.fnal.gov node
agents?node=NoWhere node =0

# PHEDEX::Web::API::AgentLogs - show messages from the agents
agentlogs?node=T1_US_FNAL_MSS&user=phedex&agent=FileRouter node
agentlogs?node=NoWhere&user=phedex&agent=FileRouter node =0
-agentlogs

# PHEDEX::Web::API::Auth - authentication information
auth auth =1

# PHEDEX::Web::API::BlockReplicas - block replicas, the reason for PhEDEx!
blockreplicas?node=T1_US_FNAL_MSS block
blockreplicas?node=T1_US_FNAL_MSS&block=/GlobalNov07-A/Online/RAW%235781e989-e16f-4bcf-bb05-03684c03e359 block
blockreplicas?node=T1_US_FNAL_MSS&complete=y&custodial=y&create_since=1241392456&update_since=1241475216 block
blockreplicas?node=T1_US_FNAL_MSS&complete=y&custodial=y&create_since=1241392456&update_since=1241475216&group=DataOps block
blockreplicas?block=/ZeroBias/BeamCommissioning09-PromptReco-v2/RECO%237e9d1e73-357e-43cb-9967-198259a1a699 block
blockreplicas?node=T1_US_FNAL_MSS&dataset=/ZeroBias/BeamCommissioning09-PromptReco-v2/RECO block

# PHEDEX::Web::API::BlockTestFiles - detailed consistency-check result
blocktestfiles?block=/ZeroBias/BeamCommissioning09-PromptReco-v2/RECO%237e9d1e73-357e-43cb-9967-198259a1a699 node

# PHEDEX::Web::API::BolckTests - consistency-check results
blocktests?block=/ZeroBias/BeamCommissioning09-PromptReco-v2/RECO%237e9d1e73-357e-43cb-9967-198259a1a699 node

# PHEDEX::Web::API::Bounce - simple data service debugging tool
bounce?hello=world
-bounce?die=tomorrow

# PHEDEX::Web::API::DashboardHistory - TransferHistory for the Dashboard
dashboardhistory link
dashboardhistory?from=T1_US_FNAL_Buffer&to=T1_US_FNAL_MSS link
dashboardhistory?from=T1_US_FNAL_Buffer&to=T1_US_FNAL_MSS&strattime=2009-04-01&endtime=2009-04-03 link

# PHEDEX::Web::API::DeleteRequests - deletion requests
deleterequests request
deleterequests?limit=2 request =2
deleterequests?request=19081 request =1
deleterequests?node=T1_US_FNAL_MSS&limit=2 request =2
deleterequests?node=NoWhere request =0

# PHEDEX::Web::API::Deletions -- Show pending and recently completed deletions
deletions dataset
deletions?node=T1_US_FNAL_MSS dataset

# PHEDEX::Web::API::ErrorLog
-errorlog
errorlog?from=T0_CH_CERN_Export&to=T1_US_FNAL_Buffer link
errorlog?from=NoWhere&to=NoWhereEither link =0

# PHEDEX::Web::API::ErrorLogSummary
errorlogsummary link
errorlogsummary?from=T0_CH_CERN_Export&to=T1_US_FNAL_Buffer link >0
errorlogsummary?from=NoWhere&to=NoWhere link =0

# PHEDEX::Web::API::FileReplicas - file replicas, the purpose of PhEDEx!
-filereplicas
filereplicas?block=/GlobalNov07-A/Online/RAW%235781e989-e16f-4bcf-bb05-03684c03e359&create_since=1196740000&custodial=n&node=T1_US_FNAL_MSS block =1
filereplicas?lfn=/store/data/GlobalNov07/A/000/030/148/GlobalNov07.00030148.0892.A.storageManager.0.0000.dat&node=T1_US_FNAL_MSS block =1
filereplicas?dataset=/GlobalNov07-A/Online/RAW&create_since=1196740000&custodial=n&node=T1_US_FNAL_MSS block >1

# PHEDEX::Web::API::Groups -- show groups known to PhEDEx
groups group >0
groups?group=DataOps group =1

# PHEDEX::Web::API::GroupUsage - storage statistics by group
groupusage node >0
groupusage?node=T1_US_FNAL_MSS node =1
groupusage?group=DataOps node >0
groupusage?group=undefined node >0

# PHEDEX::Web::API::Inject - let PhEDEx know data exists
# can not do acceptance test for now

# PHEDEX::Web::API::LFN2PFN - LFN to PFN conversion
-lfn2pfn mapping
-lfn2pfn?node=T1_US_FNAL_MSS mapping
-lfn2pfn?lfn=/store/mc/2006/11/24/mc-csa06-111-minbias/0013/E847EED9-538B-DB11-B5D0-001731AF6725.root mapping
lfn2pfn?node=T1_US_FNAL_MSS&protocol=srm&lfn=/store/mc/2006/11/24/mc-csa06-111-minbias/0013/E847EED9-538B-DB11-B5D0-001731AF6725.root mapping =1

# PHEDEX::Web::API::Links
links link >0
links?from=T1_US_FNAL_Buffer link >0
links?status=deactivated link >0
links?kind=Migration link >0

# PHEDEX::Web::API::MissingFiles
-missingfiles block
missingfiles?block=/GlobalNov07-A/Online/RAW%235781e989-e16f-4bcf-bb05-03684c03e359&create_since=1196740000&custodial=n block =1
missingfiles?lfn=/store/data/GlobalNov07/A/000/030/148/GlobalNov07.00030148.0892.A.storageManager.0.0000.dat block =1

# PHEDEX::Web::API::Nodes - list of nodes
nodes node >0
nodes?noempty=1 node >0
nodes?node=T1_US_FNAL_MSS node =1

# PHEDEX::Web::API::NodeUsage
nodeusage node >0
nodeusage?node=T1_US_FNAL_MSS node =1

# PHEDEX::Web::API::NodeUsageHistory
nodeusagehistory node >0
nodeusagehistory?node=T1_US_FNAL_MSS node
nodeusagehistory?node=T1_US_FNAL_MSS&starttime=last_week&binwidth=3600 node

# PHEDEX::Web::API::RequestList - list of request according to search criteria
requestlist request
requestlist?approval=pending request
requestlist?approval=pending&node=T1_US_FNAL* request
requestlist?approval=disapproved&node=T1_US_FNAL* request

# PHEDEX::Web::API::RoutedBlocks - show Currently routed blocks, as well as failed routing attempts (invalid routes)
routedblocks route
routedblocks?to=T1_US_FNAL*&from=T1_US_FNAL* route
routedblocks?to=T1_US_FNAL*&from=T1_US_FNAL*&valid=y route
routedblocks?to=T1_US_FNAL*&from=T1_US_FNAL*&valid=n route

# PHEDEX::Web::API::RouterHistory
routerhistory link
routerhistory?to=T1_US_FNAL_Buffer link
routerhistory?to=T1_US_FNAL_Buffer&starttime=last_week&binwidth=3600 link

# PHEDEX::Web::API::Subscriptions
subscriptions dataset >0
subscriptions?node=T1_US_FNAL_MSS dataset >0
subscriptions?node=T1_US_FNAL_MSS&move=y dataset >0
subscriptions?node=T1_US_FNAL_MSS&custodial=n dataset >0
subscriptions?dataset=/GlobalNov07-A/Online/RAW dataset =1
subscriptions?block=/Cosmics/Commissioning08_CRAFT_ALL_V9_225-v2/RECO%234a8b4c80-9758-457e-8dab-beef9ec90976 dataset =1
subscriptions?group=higgs dataset >0
subscriptions?group=higgs&priority=high dataset >0
subscriptions?suspended=y dataset >0
subscriptions?node=NoWhere dataset =0

# PHEDEX::Web::API::TFC - the trivial file catalog
-tfc
tfc?node=T1_US_FNAL_MSS storage-mapping =1

# PHEDEX::Web::API::TransferHistory - history of completed transfer attempts
transferhistory link >0
transferhistory?from=T1_US_FNAL_Buffer&to=T1_US_FNAL_MSS link =1
transferhistory?to=T1_US_FNAL_Buffer&starttime=last_week&binwidth=3600 link
transferhistory?from=NoWhere&to=NoWhereEither link =0

# PHEDEX::Web::API::TransQueueBlocks - blocks currently queued for transfer
transferqueueblocks link >0
transferqueueblocks?from=T1_US_FNAL_Buffer&to=T1_US_FNAL_MSS link =1
transferqueueblocks?priority=high link >0
transferqueueblocks?state=transferring link

# PHEDEX::Web::API::TransQueueFiles - files currently queued for transfer
transferqueuefiles link >0
transferqueuefiles?from=T1_US_FNAL_Buffer&to=T1_US_FNAL_MSS link =1
transferqueuefiles?priority=high link
transferqueuefiles?state=transferring link

# PHEDEX::Web::API::TransferQueueHistory - history of transfer queues
transferqueuehistory link >0
transferqueuehistory?from=T1_US_FNAL_Buffer&to=T1_US_FNAL_MSS link
transferqueuehistory?from=T1_US_FNAL_Buffer&to=T1_US_FNAL_MSS&starttime=last_week&binwidth=3600 link

# PHEDEX::Web::API::TransferQueueStats - current transfer queue
transferqueuestats link >0
transferqueuestats?from=T1_US_FNAL_Buffer&to=T1_US_FNAL_MSS link
transferqueuestats?from=NoWhere&to=NoWhereEither link

# PHEDEX::Web::API::TransferRequests - transfer requests
transferrequests request >0
transferrequests?node=T1_US_FNAL_MSS&limit=2 request =2
transferrequests?node=NoWhere request =0
