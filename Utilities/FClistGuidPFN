#!/usr/bin/env python2.2
from PyFileCatalog import *
from PyFCContainer import *
from PyFCAction import *
import unittest,os,os.path,getopt
def usage():
    print 'FClistGuidPFN [-g | -p] -u catalog_contactstring ITEM...'

class myobj(object):
    def __init__(self):
	self.mode = 'g'
        self.input=[]
        try:
            optlist,self.input = getopt.getopt (sys.argv[1:],'gpu:')
            #print self.input
        except getopt.GetoptError:
            usage()
            sys.exit(2)
        for o,a in optlist:
            if o == '-u':
                self.cat = a
            elif o == '-g':
                self.mode = 'g'
            elif o == '-p':
                self.mode = 'p'
            else:
                usage()
                sys.exit(2)
        try:
            self.x=PyFileCatalog.PyFileCatalog()
            self.x.setWriteCatalog(self.cat)
        except PyFileCatalogError, er:
            print 'PyFileCatalogError Caught:',er
            self.x.rollback()
        
    def list(self):
        try:
            l = PyFClookup()
            self.x.setAction(l)
            self.x.connect()
            self.x.start()
            for i in self.input:
		if (self.mode == 'g'):
                    pfns = PyFCContainer.PyFCContainer(self.x,PFN,10000)
		    l.lookupPFN("guid='" + i + "'", pfns)
                    while pfns.hasNext():
                        pentry=pfns.Next()
                        print pentry[1], " ", pentry[0]
		else:
		    result=l.lookupFileByPFN(i)
                    print i, " ", result['guid']

            self.x.commit(REFRESH)
            self.x.disconnect()
        except PyFileCatalogError, er:
             print 'PyFileCatalogError Caught:',er

if __name__=="__main__":
    y=myobj()
    y.list()
