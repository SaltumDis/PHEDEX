#!/usr/bin/perl

BEGIN { use strict; use warnings; }

sub report
{
    my ($prefix, $dir) = @_;
    my $inbox = scalar @{[<$dir/inbox/*>]};
    my $received = scalar @{[<$dir/inbox/*/go>]};
    my $pending = scalar @{[<$dir/work/*>]};
    my $bad = scalar @{[<$dir/work/*/bad>]};
    my $done = scalar @{[<$dir/work/*/done>]};
    my $outbox = scalar @{[<$dir/outbox/*>]};
    print "$prefix:",
	" @{[$inbox - $received]} pending,",
	" $received received,",
	" @{[$pending - $bad - $done]} work,",
	" $done completed,",
	" $bad bad,",
	" $outbox outgoing\n";
}

foreach $dropdir (@ARGV)
{
    print "$dropdir: \n";
    foreach $w (<$dropdir/worker-*>)
    {
	my $id = ($w =~ /worker-(\d+)/)[0];
	&report (" W$id", $w);
    }

    &report ("  M", $dropdir);
}
